(function(u){var r=window.AmazonUIPageJS||window.P,x=r._namespace||r.attributeErrors,w=x?x("AmazonDevicesDetailPageInstantSavingsAssets",""):r;w.guardFatal?w.guardFatal(u)(w,window):w.execute(function(){u(w,window)})})(function(u,r,x){u.when("A").register("trade-in-constants",function(l){return{unauthorizedCode:401,maxTradeInItemQuantityStatusCode:204,autoCompleteUrl:"https://completion.amazon.com/api/2017/suggestions?",autoCompleteUrlSuffix:"/api/2017/suggestions?",tradeInRouteBase:"/tradein/hzw/",
appraisalInputName:"appraisal",customerIpPreferenceInputName:"instantPaymentPreference",appraisalReturn:"RETURN_WORSE",appraisalAccept:"ACCEPT_WORSE",itemSelectEligibleContext:"eligible",itemSelectSearchContext:"search",maximumTradeInItemsCount:5,tradeInSearchAlias:"ereaders",tradeInSearchPageSize:20,tanookiV2DesktopRowSize:3,tanookiV2MobileRowSize:2,tanookiV2DesktopSearchPageSize:15,tanookiV2MobileSearchPageSize:10,tradeInSearchResultsLoadContext:"onLoad",tradeInSearchResultsScrollContext:"onScroll",
sessionStorageAccessErrorMsg:"Session storage access blocked",AUTH_PORTAL_ASSOC_HANDLE:{com:"amzn_tradein_horizonte_us",uk:"amzn_tradein_horizonte_uk",de:"amzn_tradein_horizonte_de"},tradeInSecondaryViewName:"tradeInSecondaryView",tradeInModalName:"tradeInModal",tradeInSideSheetName:"tradeInSideSheet",csrfKeyMap:"csrfKeyMap",csrfQueryParam:"requestToken",csrfSearchRequestKey:"searchRequestKey",csrfReviewRequestKey:"reviewRequestKey",csrfRemoveRequestKey:"removeItemRequestKey",csrfSubmitRequestKey:"submitRequestKey",
csrfSaveGradedItemKey:"saveGradedItemRequestKey",csrfSearchAsinCategoryItemKey:"searchAsinCategoryRequestKey",validConditions:"N/A;Neutral;New;LikeNew;VeryGood;Good;Working;Acceptable;Damaged;NonFunctional;Unacceptable;Ruined;Wrong Item".split(";"),resetAllElementsEvent:"resetAllElementsEvent",priceBlockSessionStorageKey:"launchTradeInPriceBlock",tanookiSessionStorageKey:"launchTradeIn",priceBlockIngressType:"tradein-price-block",tanookiBuyboxMetric:"tanooki_launch_buy_box",tanookiBuyboxMobileMetric:"tanooki_launch_buy_box_mobile",
tanookiPriceblockMetric:"tanooki_launch_price_block",tanookiPriceblockMobileMetric:"tannoki_launch_price_block_mobile",refTagPrefix:"dp_trdv2_is_",refTagPrefixMobile:"dp_trdv2_is_m_",refTagPriceBlockPrefix:"dp_price_block_",refTagPriceBlockPrefixMobile:"dp_price_block_m_",refTagListItemsView:"list_items_view",refTagSearchItemsView:"search_items_view",refTagConditionView:"condition_view",refTagConfirmationView:"confirmation_view",refTagSuccessfulView:"success_view",refTagItemSelect:"item_selected",
refTagItemDeSelect:"item_deselected",refTagSearchTermRequest:"search_term_request_",refTagSearchItemSelect:"search_item_select",refTagSearchItemRemoveClick:"search_remove_click",refTagBackClick:"back_click",refTagListItemsContinueClick:"list_items_continue_click",refTagGradedConditionClick:"graded_condition_",refTagAppraisalAccept:"appraisal_accept",refTagAppraisalReturn:"appraisal_return",refTagConditionContinueClick:"condition_continue_click",refTagReviewInstantPaymentView:"review_ip_view",refTagReviewNonInstantPaymentView:"review_nip_view",
refTagReviewMixedBagPaymentView:"review_mb_view",refTagChangeConditionClick:"change_condition_click",refTagDeleteClick:"delete_click",refTagReturnAddressUpdateRequest:"return_address_update_request",refTagReturnAddressUpdateView:"return_address_update_view",refTagTradeInMoreItems:"trade_more_items",refTagReturnToShopping:"return_to_shopping_click",refTagLogInPrompt:"log_in_prompt",refTagWeWantYouToKnow:"we_want_you_to_know_expanded",refTagPromotionInformationPopoverView:"promotion_information_panel_view",
refTagAppraisalLearnMorePopoverView:"appraisal_learn_more_panel_view",refTagRegisteredDevicesLearnMorePopoverView:"registered_devices_learn_more_panel_view",refTagViewDropOffLocations:"view_drop_off_locations",refTagViewUBIFLocations:"view_ubif_locations",refTagButtonExperimentPreFix:"tanooki_",refTagTanookiLaunchedWithBorder:"launched_with_border",refTagTanookiLaunchedWithOutBorder:"launched_without_border",refTagTermsAndConditions:"select_terms_and_conditions",refTagHowToLink:"select_how_to_link",
refTagPrintShippingLabel:"tv2_print_shipping_label",refTagNearbyProcessorsMobile:"nearby_processors_m",refTagNearbyProcessorsDesktop:"nearby_processors",refTagTv2:"tv2_",refTagAuthRequired:"AuthReq",refTagAuthCompleted:"AuthComp",refTagBackButton:"Back_",refTagExit:"Exit_",refTagEnd:"End",refTagChangeCondition:"ChgCond",refTagRemoveCartItem:"RmvItm",refTagHazmatError:"HazmatError",refTagIPDowngrade:"IPDowngrade",refTagIPUpgrade:"IPUpgrade",refTagMFAFailure:"_mfaFailure",refTagMFASuccess:"_mfaSuccess",
BIFURCATION_REF_TAG:["tradein-manufacturer","tradein-vg-type"],VIEW_REF_TAG:{manufacturer:"Man",model:"Mod","model-family":"ModFam","storage-size":"Stor","product-category":"product_category",carrier:"Carr","Console-Generation":"ConGen",platform:"Plat","trade-in-item-type":"IT",".refinement-search-view":"Search","#conditionViewTemplate":"Cond",".submit-trade-in-content":"Review",".tradein-cart-view":"Cart","#tradeinReviewYourOrderNextStepTemplate":"NxtStp"},PRODUCT_GROUP_REF_TAG:{gl_wireless:"Wir",
gl_electronics:"Elec",gl_video_games:"VG",gl_digital_video_games:"VG",gl_digital_products_3:"AUCC"},PRODUCT_GROUP_FLOW_REF_TAG:{gl_wireless:"WL",gl_electronics:"WL",gl_video_games:"VG",gl_digital_video_games:"VG",gl_digital_products_3:"AUCC"},APPRAISAL_REF_TAG:{ACCEPT_WORSE:"Accpt",RETURN_WORSE:"Dcln"},eligibleListViewClass:".tradein-eligible-list-view",searchResultsListViewClass:".tradein-search-results-list-view",selectedItemConditionViewClass:".tradein-selected-item-condition-view",selectedItemsConfirmationViewClass:".tradein-selected-items-confirmation-view",
successfulViewClass:".tradein-successful-view",tradeInWrapperClass:".tradein-wrapper",checkboxItemThumbTemplateId:"#checkboxItemThumbTemplate",eligibleItemTemplateId:"#eligibleItemTemplate",questionRadioButtonTemplateId:"#questionRadioButtonTemplate",questionRadioTemplateId:"#questionRadioTemplate",radioButtonTemplateId:"#radioButtonTemplate",itemConfirmationTemplateId:"#itemConfirmationTemplate",asinDetailsViewTemplateId:"#asinDetailsViewTemplate",eligibleListViewTemplateId:"#eligibleListViewTemplate",
pastPurchasedListViewTemplateId:"#pastPurchasedListViewTemplate",searchResultsListViewTemplateId:"#searchResultsListViewTemplate",searchResultItemTemplateId:"#searchResultItemTemplate",selectedItemConditionViewTemplateId:"#selectedItemConditionViewTemplate",selectedItemsConfirmationViewTemplateId:"#selectedItemsConfirmationViewTemplate",successfulTradeInViewTemplateId:"#successfulTradeInViewTemplate",radioButtonRestrictionSelectionTemplateId:"#radioButtonRefinementSelectorViewTemplate",cardItemRestrictionSelectionViewTemplateId:"#searchRestrictionCardItemSelectionTemplate",
conditionViewTemplateId:"#conditionViewTemplate",tradeinHeaderViewTemplateId:"#tradeinHeaderViewTemplate",tradeinCartHeaderTemplateId:"#tradeInCartHeaderTemplate",tradeinCartSubmitViewHeaderTemplateId:"#tradeInCartHeaderTemplateSubmitView",tradeInCartPromosTemplateId:"#tradeInCartPromosTemplate",tradeInPromoPreviewViewTemplate:"#tradeInPromoPreviewViewTemplate",verticalComplexCardViewTemplateId:"#verticalComplexCardViewTemplate",appraisalSelectionComponentViewId:"#appraisalSelectionComponentView",
promotionInformationComponentId:"#promotionInformationComponent",appraisalWrapperClass:".appraisal-wrapper",conditionAppraisalMaxTivClass:".appraisal-max-tiv",appraisalTivHeaderClass:".appraisal-tiv-header",appraisalTivPriceClass:".appraisal-tiv",termsAndAgreementViewTemplateId:"#termsAndAgreementViewTemplate",multiItemTermsAndAgreementViewTemplateId:"#additionalItemTermsAndAgreementViewTemplate",multiItemTermsAndAgreementViewTemplateDevicesId:"#additionalItemTermsAndAgreementViewTemplateDevices",
tradeinReviewYourOrderNextStepTemplateId:"#tradeinReviewYourOrderNextStepTemplate",mixedOfferNextStepsTemplateId:"#mixedOfferNextStepsTemplate",multiItemConfirmationOrderDetailsViewComponentClass:".multiItemConfirmationOrderDetailsViewComponent",wirelessHowToViewTemplateId:"#wirelessHowToViewTemplate",howToLinkHelperTitleId:"#categoryHelperTitle",tradeinFooterComponentId:"#tradeinFooterComponent",successfulTradeInBannerComponentViewId:"#successfulTradeInBannerComponentView",restrictionSelectionViewTemplateId:"#restrictionSelectionViewTemplate",
tradeInSubmitConditionButtonTemplateId:"#tradeInSubmitConditionButtonTemplate",conditionQuestionnaireListClass:".questionnaires-list",conditionQuestionContainerClass:".condition-question-container",conditionQuestionButtonSelectorClass:".question-selector-button",conditionPageEstimatedTivComponentsSelector:"#tradeinEstimateOfferComponent .estimate-component",conditionPageFinalTivComponentsSelector:"#tradeinEstimateOfferComponent .final-component",conditionPageHeaderTivSelector:"#tradeinEstimateOfferComponent #tradeInValue",
binaryQuestionnaireListViewTemplateId:"#binaryQuestionnaireListViewTemplate",searchRefinementItemSelectionTemplateId:"#searchRefinementItemSelectionTemplate",refinementSearchViewTemplateId:"#refinementSearchViewTemplate",refinementSearchInputSelector:".refinement-search-input",refinementSearchInputMobileSelector:".refinement-search-input input",refinementSearchAllOffersCountId:"#searchAllOffersCount",refinementSearchOnlyOffersCountId:"#searchOnlyOffersCount",refinementSearchResultSelector:".refinement-selection-content .refinement-column",
shipmentDetailViewComponentId:"#shipmentDetailViewComponent",dropOffBannerNoLinkComponentId:"#dropOffBannerNoLinkComponent",dropOffBannerNoLinkTemplateId:"#dropOffBannerNoLinkTemplate",dropOffLocationExpanderId:"#dropOffLocationExpander",dropOffLocationsTemplateId:"#dropOffLocationsTemplate",dropOffLocationListTemplateId:"#dropOffLocationListTemplate",offlineMessageSectionClass:".offline-message-section",tradeInOfferOverviewTemplateId:"#tradeInOfferOverviewTemplate",categoryRefinementSelectionItemComponentId:"#categoryRefinementSelectionItemComponent",
tradeinCartItemComponentId:"#tradeInCartItemComponent",shipmentDetailsHeaderComponentClass:".shipment-details-header-component",tradeinSubmitButtonComponentClass:".tradein-submit-button-container",tradeinSubmitWrapperComponentId:"#tradeinSubmitWrapper",refinementSelectionViewWrapperClass:".refinement-selection-view",refinementContentWrapperClass:".refinement-content-wrapper",refinementSearchViewClass:".refinement-search-view",submitTradeInWrapperClass:".submit-trade-in-content",searchRestrictionWrapperClass:".search-restriction-wrapper",
searchLoadMoreResultsWrapperClass:".load-more-results-wrapper",cardItemRestrictionSelectionViewClass:".restriction-selection-view",wirelessTradeInReviewYourOrderViewClass:".wireless-tradein-review-your-order-view",tradeInCartViewClass:".tradein-cart-view",tradeInCartTemplateId:"#tradeInCartViewTemplate",tradeinCartTotalTivElement:".cart-total-tiv",tradeinCartGCValueIpElement:"#gcValueIp",tradeinCartGCValueNonIpElement:"#gcValueNonIp",tradeinCartIpItemsSection:".tradein-cart-view-ip-items",tradeinCartNonIpItemsSection:".tradein-cart-view-nip-items",
tradeinCartIpItemsList:".tradein-cart-item-list-ip",tradeinCartNonIpItemsList:".tradein-cart-item-list-nip",continueConditionButtonViewClass:".continue-trigger",submitButtonViewClass:".handle-submit-your-tradein",reviewButtonViewClass:".handle-review-your-tradein",tradeInMoreItemsButtonViewClass:".handle-trade-in-more-items",agreementCheckboxTarget:".agreement-checkbox-target",tradeInMoreItemsButtonContainerClass:".tradein-more-items-button-container",searchInputClass:".search-input",searchInputClassMobile:".search-input input",
searchFormClass:".search-form",searchSuggestionsClass:".tradein-autocomplete-dropdown-menu",eligibleItemsCountId:"#eligibleItemsCount",dateRegisteredClass:".registered-date",eligibleItemListClass:".tradein-eligible-item-list",eligibleItemListWrapper:".tradein-eligible-item-list-wrapper",searchResultListClass:".tradein-search-result-list",reviewTradeInItemsSubmitId:"#reviewTradeInItemsSubmit",customerPastDevicesPurchasesCarouselContainerId:"#customerPastDevicesPurchasesCarouselContainer",currentSelectedItemIndexId:"#currentSelectedItemIndex",
selectedItemTotalCountId:"#selectedItemTotalCount",backButtonClass:".back-button",continueButtonClass:".continue-button",alertMaxItemQuantityClass:".tradein-error-quantity-limit",alertMaxItemsWarningClass:".tradein-warning-max-items",alertMaxItemsWarningClassMobile:".tradein-mobile-warning-max-items",alertMaxGCValueWarningClass:".tradein-warning-max-gc-value",alertMaxGCValueWarningClassMobile:".tradein-mobile-warning-max-gc-value",alertPromptLoginClass:".tradein-prompt-log-in",alertItemAcceptableClass:".tradein-info-unacceptable-error",
alertItemAcceptableClassMobile:".tradein-mobile-info-unacceptable-error",alertMaxItemQuantityBannerClass:".tradein-max-quantity-error",loadingSpinnerClass:".tradein-loading-spinner",loadingSideSheetSpinnerClass:".asin-selection-tradein-loading-spinner",searchLoadingSpinnerClass:".tradein-search-loading-spinner",tradeinCartHeaderItemsSingularClass:".tradein-cart-header-items-singular",tradeinCartHeaderItemsPluralClass:".tradein-cart-header-items-plural",tradeInQuantityExceededErrorSelector:".tradein-templates .tradein-info-quantity-exceeded-error",
tradeInErrorExitButtonSelector:".tradein-templates .tradein-error-exit-button",tradeInMixHazmatErrorSelector:".tradein-templates .tradein-info-mix-hazmat-error",tradeInMixHazmatCartItemErrorSelector:".tradein-templates .tradein-info-mix-hazmat-error-cart-item",tradeInHazmatItemList:".hazmat-item-list",tradeInHazmatListItemTemplate:".hazmat-asin-list-item-template",tradeInNonTradeableErrorSelector:".tradein-templates .tradein-info-non-tradeable-error",complexCardRefinementSelectionViewType:"COMPLEX_CARD_VIEW",
simpleCardRefinementSelectionViewType:"SIMPLE_CARD_VIEW",containedButtonRefinementSelectionViewType:"CONTAINED_BUTTON_VIEW",searchRefinementViewType:"SEARCH_CARD_VIEW",tradeInItemTypeEcho:"US_Echo",tradeInEchoGl:"gl_digital_products_3",tradeInWirelessGl:"gl_wireless",tradeInVGGl:"gl_video_games",tradeInDigitalVGGL:"gl_digital_video_games",tradeInElectronicsGL:"gl_electronics",wirelessVgProductGroups:["gl_wireless","gl_video_games","gl_digital_video_games","gl_electronics"],tradeInCCCardEligibleGls:["gl_wireless"],
tradeInLaunchButtonDeclarativeActionSelector:"#tradeInLaunchAction",instantPaymentPreferenceInputName:"instantPaymentPreference",instantPaymentNow:"PAID_NOW",instantPaymentLater:"PAID_LATER"}});"use strict";u.when("A","trade-in-constants","tanooki-ingress-button-treatment").register("trade-in-common-utils",function(l,m,k){var a=l.$,h={locale:null,currencyCode:null,productGroup:null,deviceType:null,asin:null,modalTitle:null,refTagPrefix:null,refTagPrefixMobile:null,captureTradeInContext:function(){var d=
a("#tanookiWidgetState").data("tanookiWidgetState");d?(d.hasOwnProperty("productGroup")?this.productGroup=d.productGroup:this.recordMetric("productGroupMissing"),d.hasOwnProperty("deviceType")?this.deviceType=d.deviceType:this.recordMetric("deviceTypeMissing"),d.hasOwnProperty("tanookiTitle")?this.modalTitle=d.tanookiTitle:this.recordMetric("deviceModalHeaderMissing"),d.hasOwnProperty("asin")&&(this.asin=d.asin)):this.recordMetric("widgetContextMissing")},updateTradeInContext:function(d){var f=a("#tanookiWidgetState").data("tanookiWidgetState");
f.hasOwnProperty("productGroup")&&d.hasOwnProperty("productGroup")&&(f.productGroup=d.productGroup);f.hasOwnProperty("deviceType")&&d.hasOwnProperty("deviceType")&&(f.deviceType=d.deviceType);f.hasOwnProperty("tanookiTitle")&&d.hasOwnProperty("tanookiTitle")&&(f.tanookiTitle=d.tanookiTitle);f.hasOwnProperty("asin")&&d.hasOwnProperty("asin")&&(f.asin=d.asin);document.getElementById("tanookiWidgetState").dataset.tanookiWidgetState=JSON.stringify(f);this.captureTradeInContext()},getProductGroup:function(){return this.productGroup},
setRefTagPrefix:function(a){this.refTagPrefix=a},getRefTagPrefix:function(){return this.refTagPrefix?this.refTagPrefix:m.refTagPrefix},setRefTagPrefixMobile:function(a){this.refTagPrefixMobile=a},getRefTagPrefixMobile:function(){return this.refTagPrefixMobile?this.refTagPrefixMobile:m.refTagPrefixMobile},getCurrentAsin:function(){return this.asin},getDeviceType:function(){return this.deviceType},getModalTitle:function(){return this.modalTitle||""},setLocale:function(a){this.locale=a},setCurrencyCode:function(a){this.currencyCode=
a},formatCurrency:function(a){this.currencyCode||this.recordError("Missing currency code","trade-in-common-utils");a=parseFloat(a);return a.toLocaleString(this.locale.replace("_","-"),{style:"currency",currency:this.currencyCode})},formatDate:function(a){if(!a)return"";a=a.split(" ");return a[0]+" "+a[1]+" "+a[2]},redirectToAuth:function(a,f){var h=r.location,c="https://"+h.host,b=h.search.replace(/\&$/,""),h=h.pathname+b+h.hash,b=c;-1<c.indexOf("aka.corp.amazon.com")&&(b="https://development.amazon.com");
a=b+"/ap/signin?_encoding\x3dUTF8\x26openid.assoc_handle\x3d"+a+"\x26openid.claimed_id\x3dhttp://specs.openid.net/auth/2.0/identifier_select\x26openid.identity\x3dhttp://specs.openid.net/auth/2.0/identifier_select\x26openid.mode\x3dcheckid_setup\x26openid.ns\x3dhttp://specs.openid.net/auth/2.0\x26openid.return_to\x3d"+c+h;try{r.sessionStorage&&sessionStorage.setItem(f,!0)}catch(g){this.recordError(g,"Session storage access blocked")}r.location.href=encodeURI(a)},redirectToMFA:function(a){var f="https://"+
r.location.host;-1<f.indexOf("aka.corp.amazon.com")&&(f="https://development.amazon.com");r.location.href=encodeURI(f+a)},getAuthPortalHandleFromHostname:function(){var a=r.location.hostname.match(/^(?:(?:(?:(\w\w)-)?pre-prod)|(?:(?:(\w\w)-)?development)|(?:.+))\.amazon.(?:(\w\w)|(com)|(?:co\.(?:(\w\w))))?$/);if(a)for(var f=1;f<a.length;f++)if(a[f])return m.AUTH_PORTAL_ASSOC_HANDLE[a[f]];return m.AUTH_PORTAL_ASSOC_HANDLE.com},recordError:function(a,f){r.ueLogError&&r.ueLogError({message:a,logLevel:"ERROR",
attribution:"tradein: "+f})},recordMetric:function(a){r.ue&&r.ue.count&&(a="tradeIn_"+a,r.ue.count(a,(r.ue.count(a)||0)+1))},findMinMaxTivInContainer:function(a){var f,h;Object.keys(a).forEach(function(c,b){c=a[c];0===b?h=f=c.tiv:(b=c.tiv,f=b<f?b:f,h=b>h?b:h)});return[f,h]},getMashModalUrl:function(a){var f="https://"+r.location.host,h="\x26cb\x3d"+Math.round((new Date).getTime()/1E3);return f+a+h},getCsrfTokenByKey:function(a,f){return f.hasOwnProperty(m.csrfKeyMap)&&f[m.csrfKeyMap][a]?f[m.csrfKeyMap][a]:
""},updateCsrfTokenByKey:function(a,f,h){f.hasOwnProperty(a)&&h.hasOwnProperty(m.csrfKeyMap)&&(h[m.csrfKeyMap][a]=f[a])},recordRefTag:function(a,f,h,c){a=f+h+a;c=a+"_"+this.deviceType+"_"+c;this.doRecordRefTag(a);this.doRecordRefTag(c)},recordTv2RefTag:function(a,f,h){var c="";Array.isArray(h)&&0<h.length&&(c=h.join("_")+"_");a=f+this.getTv2RefTagPrefix()+"_"+c+a+"_"+this.getTv2RefTagPostfix();this.doRecordRefTag(a)},doRecordRefTag:function(d){l.get(d,{error:a.proxy(function(a,d,c){this.recordError(d+
"::"+c,"Error encountered during refTag record request")},this)})},getIngressButtonRefTag:function(){return k.isEnabled?m.refTagTanookiLaunchedWithOutBorder:m.refTagTanookiLaunchedWithBorder},isMobileVariant:function(a){return 0<=["mobile","mobileApp","mobileWeb"].indexOf(a)},getTanookiV2RowSize:function(a){return this.isMobileVariant(a)?m.tanookiV2MobileRowSize:m.tanookiV2DesktopRowSize},getTanookiV2SearchPageSize:function(a){return this.isMobileVariant(a)?m.tanookiV2MobileSearchPageSize:m.tanookiV2DesktopSearchPageSize},
isWirelessVgProductGroup:function(a){return-1!==m.wirelessVgProductGroups.indexOf(a)},shouldLaunchTanookiV2OnPageLoad:function(){try{if(r.sessionStorage){var a=sessionStorage.getItem("launchAsinCategoryTradeIn"),f={productGroup:sessionStorage.getItem("storefront-product-group"),deviceType:sessionStorage.getItem("storefront-device-type"),modalTitle:sessionStorage.getItem("storefront-modal-title")};f.productGroup&&this.updateTradeInContext(f);return a?(sessionStorage.removeItem("launchAsinCategoryTradeIn"),
sessionStorage.removeItem("storefront-product-group"),sessionStorage.removeItem("storefront-device-type"),sessionStorage.removeItem("storefront-modal-title"),sessionStorage.removeItem("is-storefront"),!0):!1}}catch(k){h.recordError(k,"Session storage access blocked")}},getStorefrontSessionStorage:function(){try{if(r.sessionStorage&&sessionStorage.getItem("is-storefront"))return!0}catch(a){h.recordError(a,"Session storage access blocked")}},setStorefrontSessionStorage:function(a){try{r.sessionStorage&&
(a&&sessionStorage.setItem("is-storefront",!0),sessionStorage.setItem("storefront-product-group",h.getProductGroup()),sessionStorage.setItem("storefront-device-type",h.getDeviceType()),sessionStorage.setItem("storefront-modal-title",h.getModalTitle()))}catch(f){h.recordError(f,"Session storage access blocked")}},getSortedConditionTradeInValues:function(d){var f=[],k=d.conditionOfferMap,c=m.validConditions,b;for(b in k)if(k.hasOwnProperty(b))if(-1===a.inArray(b,c))h.recordError("Invalid condition",
b+" was not found in validConditions array for type: "+d.tradeInItemType);else{var g=k[b];g.hasOwnProperty("tiv")&&f.push(g.tiv)}f.sort(function(a,b){return a-b});return f},getProductGroupRefTag:function(a){return m.PRODUCT_GROUP_FLOW_REF_TAG[a]},getTv2RefTagPrefix:function(){return m.refTagTv2+m.PRODUCT_GROUP_FLOW_REF_TAG[this.productGroup]},getTv2RefTagPostfix:function(){return("web"===this.deviceType?"D_":"M_")+m.PRODUCT_GROUP_REF_TAG[this.productGroup]},generatePrettyTitle:function(a){return a.split("(Trade")[0]},
isGlEligibleForPastPurchases:function(a){return a===m.tradeInEchoGl},isGlEligibleForPromotions:function(a){return a===m.tradeInEchoGl},isCETechGl:function(a){return a===m.tradeInWirelessGl||a===m.tradeInDigitalVGGL||a===m.tradeInVGGl||a===m.tradeInElectronicsGL},isTradeInLaunchedFromWisper:function(a){return["launch-tanooki-wireless","redirect-to-login-wireless"].includes(a)},isGlEligibleForCCCard:function(a){return m.tradeInCCCardEligibleGls.includes(a)},createNearbyProcessorsList:function(d,f,h){f.empty();
a.each(d,a.proxy(function(c,b){c=a("\x3cdiv/\x3e");var g=a("\x3cdiv/\x3e"),p=a("\x3cdiv/\x3e"),d=a("\x3cdiv/\x3e"),e=b.processorAddress.line1+" "+b.processorAddress.line2,n=b.processorAddress.city+" "+b.processorAddress.state+" "+b.processorAddress.postalCode+" "+b.processorAddress.countryCode;c.html(b.processorAddress.fullName).addClass("a-text-bold a-spacing-top-medium");g.html(e);p.html(n);f.append(c).append(g).append(p).append(d);h.append(f)},this))}};l.on("a:pageUpdate",function(){l.state.parse();
h.captureTradeInContext()});return h});"use strict";u.when("A").register("trade-in-data-binder",function(l){function m(a,f,k,c,b){var g=a.find(".refinement-content-wrapper"),p=0;0<c.length&&(p=b.getTanookiV2RowSize(k));if(g&&0<p){k=Math.ceil(f.length/p);var q="a-span"+Math.floor(12/p);b=h(g).find(".dynamic-row");for(var q=b.find(".refinement-column").removeClass("a-span12").addClass(q),e=0;e<p-1;e++){var n=h(q).clone();b.append(n)}for(p=0;p<k-1;p++)q=b.clone(),g.append(h(q));a.find(".refinement-column").each(function(a,
b){b=h(b);b.data("dynamicColumn")&&(b.find(".refinement-selection-component-view").each(function(a,b){a=h(b);a.data("viewType")!==c&&a.remove()}),a>=f.length&&b.addClass("aok-hidden"))})}}function k(a,f){var h=!1;a.hasOwnProperty("showBooleanField")&&(a=a.showBooleanField,"!"===a.charAt(0)?(a=a.substr(1),h=!1===f.hasOwnProperty(a)?!0:!1!==f[a]):h=!1===f.hasOwnProperty(a)?!0:!0!==f[a]);return h}function a(a,f){var h=a.lastIndexOf(".");-1!==h&&(a=[a.slice(0,h+1),"_SL"+f+"_SR"+f+","+f+"_.",a.slice(h+
1)].join(""));return a}var h=l.$;return{bindDataToTemplate:function(d){if(!(0<d.length&&""===h.trim(d.html()))){var f=h(d.clone().html());f.find("*").each(function(a,b){a=h(b);if(b=a.data("transcludeTemplate"))b=h(".tradein-templates #"+b),0<b.length&&a.html(b.clone().html())});try{if(1<arguments.length)for(var l=f.find("*"),c=1;c<arguments.length;c++){var b=arguments[c];l.each(h.proxy(function(g,c){g=h(c);c=g.data();if(c.hasOwnProperty("hideEmptyField")?!b.hasOwnProperty(c.hideEmptyField)||!b[c.hideEmptyField]:
k(c,b))return g.remove(),!0;g.show();for(var d in b)if(b.hasOwnProperty(d)&&(c=g.data(d))&&"string"===typeof c)switch(c){case "id":c=b[d];"date"===g.data("decorator")&&(c=this.tradeInCommonUtils.formatDate(c));g.find("#"+d).html(c);break;case "text":c=b[d];"price"===g.data("decorator")&&(c=this.tradeInCommonUtils.formatCurrency(c.toFixed(2)));g.html(c);break;case "textAppend":c=b[d];g.append(c);break;case "data":g.attr("data-"+d,b[d]);break;case "bind":break;default:var e=b[d];"squareImage"===g.data("decorator")&&
(e=a(e,300));g.attr(c,e)}},this))}}catch(g){this.tradeInCommonUtils.recordError(g,"Error encountered during data bind to template")}return f}},setCommonUtils:function(a){this.tradeInCommonUtils=a},bindCategoryRefinementDataToTemplate:function(d,f,l,c){c=c||{};var b=f.selectionItemsAttributeList,g=f.refinementTitle,p=f.refinementKey;f=f.viewType;if(!(0<d.length&&""===h.trim(d.html()))){d=h(d.clone().html());m(d,b,l,f,this.tradeInCommonUtils);var q=0;try{var e=d.find("*"),n=c;e.each(h.proxy(function(t,
c){t=h(c);c=t.data();if(k(c,n))return t.remove(),!0;t.show();c.hasOwnProperty("refinementTitle")&&t.html(g);c.hasOwnProperty("endColumn")&&q++;c.hasOwnProperty("maxTiv")&&q<b.length&&t.html(this.tradeInCommonUtils.formatCurrency(b[q].maxTiv));c.hasOwnProperty("displayTitle")&&q<b.length&&t.html(b[q].displayTitle);if(c.hasOwnProperty("imageUrl")&&q<b.length){var e=b[q].imageUrl;c.hasOwnProperty("decorator")&&"squareImage"===c.decorator&&(e=a(e,150));t.attr(t.data("imageUrl"),e)}c.hasOwnProperty("asinDetailsData")&&
q<b.length&&(e={maxTiv:b[q].maxTiv,refinementKey:p,refinementValue:b[q].emittedData},b[q].asinDisplayProperties&&(e.platform=b[q].asinDisplayProperties.hardwarePlatform,e.ean=b[q].asinDisplayProperties.eanNumber,e.upc=b[q].asinDisplayProperties.upc),b[q].imageUrl&&(e.imageUrl=b[q].imageUrl),b[q].displayTitle&&(e.displayTitle=b[q].displayTitle),b[q].hasOwnProperty("isEnabled")&&(e.isEnabled=b[q].isEnabled),t.data("asinDetailsData",e));c.hasOwnProperty("tradeinSupplementaryData")&&q<b.length&&(e={maxTiv:b[q].maxTiv},
b[q].imageUrl&&(e.imageUrl=b[q].imageUrl),e.maxTiv&&t.data("tradeinSupplementaryData",e));c.hasOwnProperty("refinementKey")&&q<b.length&&t.data("refinementKey",p);c.hasOwnProperty("refinementValue")&&q<b.length&&t.data("refinementValue",b[q].emittedData);c.hasOwnProperty("disabledAttribute")&&q<b.length&&(b[q].hasOwnProperty("isEnabled")&&!b[q].isEnabled&&(c=t.closest(".submit-refinement"),c.addClass("a-button-toggle"),c.addClass("a-button-unavailable"),t.addClass("a-button-disabled"),h(t).attr("disabled",
!0),t.closest(".card-content-box").addClass("unavailable-item")),t.attr(t.data("disabledAttribute"),b[q].isEnabled))},this))}catch(t){throw this.tradeInCommonUtils.recordError(t,"Error binding data to REFINEMENT SELECTION template"),"[Error at bindCategoryRefinementDataToTemplate]"+t;}return d}},bindDataToAsinSelectionTemplate:function(a){if(!(0<a.length&&""===h.trim(a.html()))){var f=h(a.clone().html());try{if(1<arguments.length)for(var l=f.find("*"),c=1;c<arguments.length;c++){var b=arguments[c];
l.each(h.proxy(function(a,c){a=h(c);c=a.data();var d=!1;if(c.hasOwnProperty("instantPaymentEligible")){var e=c.instantPaymentEligible;b.hasOwnProperty("instantPaymentEligible")&&e!==b.instantPaymentEligible&&(d=!0)}else d=k(c,b);if(d)return a.remove(),!0;a.show();c.hasOwnProperty("progressPercentage")&&b.hasOwnProperty("progressPercentage")&&a.css("width",b.progressPercentage);c.hasOwnProperty("tradeinSupplementaryData")&&a.data("tradeinSupplementaryData",{maxTiv:b.maxTiv,imageUrl:b.imageUrl});c.hasOwnProperty("refinementKey")&&
a.data("refinementKey",b.restrictionKey);c.hasOwnProperty("refinementValue")&&a.data("refinementValue",b.restrictionValue);for(var n in b)if(b.hasOwnProperty(n)&&(c=a.data(n))&&"string"===typeof c)switch(c){case "displayTitle":a.html(b[n]);break;case "subtitle":a.html(b[n]);break;case "src":a.attr(c,b[n]);break;case "classType":a.removeClass("aok-hidden");break;case "tiv":a.html(this.tradeInCommonUtils.formatCurrency(b[n]));break;case "data":a.attr("data-"+n,b[n])}},this))}}catch(g){throw this.tradeInCommonUtils.recordError(g,
"Error encountered during binding data to the refinementTemplate"),"[Error at bindDataToAsinSelectionTemplate]"+g;}return f}},normalizeGridRowHeights:function(a){h(a).find(".dynamic-row").each(function(a,d){a=h(d).find(".refinement-search-item-title");var c=0;a.each(function(a,g){a=h(g);a.outerHeight()>c&&(c=a.outerHeight())});a.each(function(a,g){h(g).css("height",c)})})}}});"use strict";u.when("A","a-popover","a-button","trade-in-constants","trade-in-common-utils","trade-in-data-binder","ip-preference-buttons",
"tanooki-offline","ready").register("trade-in-base-controller",function(l,m,k,a,h,d,f,v){var c=l.$;return l.createClass({config:null,deviceType:null,authPortalAssocHandle:null,selectedEligibleItems:null,navViews:null,navCurrentView:null,navHistory:null,boundedViews:[],searchIsInProgress:!1,searchResultsCache:[],selectedSearchResultItems:null,tradeInReviewData:null,tradeInSubmitData:null,instantPaymentEligible:!1,customerIpPreference:null,instantPaymentMixed:!1,promotionEligible:!1,hasInitiallyLoaded:!1,
hasMaxItemsSelected:!1,hasPendingRequest:!1,promosApplied:[],tradeInViewInstanceName:null,tradeInSaveGradedItemConditionUrl:null,tradeInReviewUrl:null,tradeInRemoveItemUrl:null,tradeInSearchUrl:null,tradeInSubmitUrl:null,tradeInRefTagUrl:null,tradeInRefTagPrefix:null,tradeInProductGroup:null,tradeInSearchCurrentCacheEntry:null,tradeInWrapper:null,loadingSpinner:null,searchInput:null,checkboxItemThumbTemplate:null,eligibleItemTemplate:null,questionRadioButtonTemplate:null,questionRadioTemplate:null,
radioButtonTemplate:null,itemConfirmationTemplate:null,searchResultsListViewTemplate:null,searchResultItemTemplate:null,dropOffBannerNoLinkTemplate:null,dropOffLocationExpander:null,eligibleListViewTemplate:null,selectedItemConditionViewTemplate:null,selectedItemsConfirmationViewTemplate:null,successfulTradeInViewTemplate:null,load:function(){this.config=l.state("tradeInConfig");h.setLocale(this.config.locale);h.setCurrencyCode(this.config.currencyCode);d.setCommonUtils(h);this.navViews={eligibleListView:a.eligibleListViewClass,
selectedItemConditionView:a.selectedItemConditionViewClass,selectedItemsConfirmationView:a.selectedItemsConfirmationViewClass,successfulView:a.successfulViewClass};this.getElements();this.bindEvents();this.cleanState();this.restoreFromState();this.navCurrentView=this.navViews.eligibleListView;this.createView()},setConstants:function(b,c,d){this.tradeInViewInstanceName=b;this.tradeInRefTagPrefix=d;this.tradeInProductGroup=c;this.tradeInSaveGradedItemConditionUrl=a.tradeInRouteBase+"addToTradeIn";this.tradeInReviewUrl=
a.tradeInRouteBase+"reviewTradeInOrder?deviceType\x3d"+this.deviceType+"\x26productGroup\x3d"+c+"\x26ref_\x3d"+d+"review_request_"+c;this.tradeInRemoveItemUrl=a.tradeInRouteBase+"removeItem?deviceType\x3d"+this.deviceType+"\x26ref_\x3d"+d+"remove_item_request_"+c;this.tradeInSearchUrl=a.tradeInRouteBase+"searchItems?deviceType\x3d"+this.deviceType+"\x26ref_\x3d"+d+"search_request_"+c;this.tradeInSubmitUrl=a.tradeInRouteBase+"confirmTradeInOrder?deviceType\x3d"+this.deviceType+"\x26ref_\x3d"+d+"submit_request_"+
c;this.tradeInRefTagUrl=a.tradeInRouteBase+"recordRefTag?deviceType\x3d"+this.deviceType+"\x26ref_\x3d"},getElements:function(){this.tradeInWrapper=this.base.find(a.tradeInWrapperClass);this.checkboxItemThumbTemplate=this.base.find(a.checkboxItemThumbTemplateId);this.eligibleItemTemplate=this.base.find(a.eligibleItemTemplateId);this.questionRadioButtonTemplate=this.base.find(a.questionRadioButtonTemplateId);this.questionRadioTemplate=this.base.find(a.questionRadioTemplateId);this.radioButtonTemplate=
this.base.find(a.radioButtonTemplateId);this.itemConfirmationTemplate=this.base.find(a.itemConfirmationTemplateId);this.searchResultItemTemplate=this.base.find(a.searchResultItemTemplateId);this.dropOffBannerNoLinkTemplate=this.base.find(a.dropOffBannerNoLinkTemplateId);this.dropOffLocationExpander=this.base.find(a.dropOffLocationExpanderId);this.eligibleListViewTemplate=this.base.find(a.eligibleListViewTemplateId);this.searchResultsListViewTemplate=this.base.find(a.searchResultsListViewTemplateId);
this.selectedItemConditionViewTemplate=this.base.find(a.selectedItemConditionViewTemplateId);this.selectedItemsConfirmationViewTemplate=this.base.find(a.selectedItemsConfirmationViewTemplateId);this.successfulTradeInViewTemplate=this.base.find(a.successfulTradeInViewTemplateId);this.searchInput=this.base.find(this.searchInputClass);this.loadingSpinner=this.base.find(a.loadingSpinnerClass)},bindEvents:function(){this.tradeInWrapper.delegate("a.tradein-login","click",c.proxy(function(){var a=h.getAuthPortalHandleFromHostname();
h.redirectToAuth(a,"launchTradeIn")},this));this.tradeInWrapper.delegate(a.eligibleListViewClass+' .selectable-wrapper input[type\x3d"checkbox"]',"change",c.proxy(function(b){this.handleSelectableItemClick(b,a.itemSelectEligibleContext)},this));this.tradeInWrapper.delegate(a.eligibleListViewClass+" .selectable-wrapper .selectable-item.disabled.maxasin","click",c.proxy(function(b){b=c(b.currentTarget);0===b.find(a.alertMaxItemQuantityClass).length&&b.find(".tradein-item-info").prepend(c("#alertTemplates "+
a.alertMaxItemQuantityClass).clone())},this));this.tradeInWrapper.delegate(".selectable-item.disabled","click",c.proxy(function(a){this.hasMaxItemsSelected&&this.showAlert(this.alertMaxItemsWarningClass,c(a.currentTarget))},this));this.tradeInWrapper.delegate(a.reviewTradeInItemsSubmitId,"click",c.proxy(function(){this.recordRefTag(a.refTagListItemsContinueClick);this.navCurrentView=this.navViews.selectedItemConditionView;this.goToView()},this));this.tradeInWrapper.delegate(a.selectedItemConditionViewClass+
" "+a.continueButtonClass,"click",c.proxy(this.handleContinueButtonClick,this));this.tradeInWrapper.delegate(a.selectedItemConditionViewClass+" "+a.backButtonClass,"click",c.proxy(this.handleBackButtonClick,this));this.tradeInWrapper.delegate(".button-question","click",c.proxy(this.handleQuestionButtonClick,this));this.tradeInWrapper.delegate('input[name\x3d"'+a.appraisalInputName+'"]',"click",c.proxy(this.handleAppraisalRadioChange,this));this.tradeInWrapper.delegate('input[name\x3d"'+a.customerIpPreferenceInputName+
'"]',"click",c.proxy(this.handleIpPreferenceRadioChange,this));this.tradeInWrapper.delegate(".delete-link","click",c.proxy(this.handleConfirmDeleteClick,this));this.tradeInWrapper.delegate(".change-link","click",c.proxy(this.handleConfirmChangeClick,this));this.tradeInWrapper.delegate("#tradeInMoreItems","click",c.proxy(function(){this.recordRefTag(a.refTagTradeInMoreItems);this.resetEligibleListView();this.navCurrentView=this.navViews.eligibleListView;this.createView()},this));this.tradeInWrapper.delegate("#confirmTradeInSubmit",
"click",c.proxy(this.doTradeInSubmit,this));this.tradeInWrapper.delegate(".search-input","focusin",c.proxy(function(){this.tradeInWrapper.find(".search-button").addClass("active")},this));this.tradeInWrapper.delegate(".search-input","focusout",c.proxy(function(){this.tradeInWrapper.find(".search-button").removeClass("active")},this));this.tradeInWrapper.delegate(a.searchFormClass,"submit",c.proxy(this.handleSearchFormSubmit,this));this.tradeInWrapper.delegate(a.searchResultsListViewClass+" "+a.searchResultListClass+
' input[type\x3d"checkbox"]',"change",c.proxy(function(b){this.handleSelectableItemClick(b,a.itemSelectSearchContext)},this));this.tradeInWrapper.delegate(a.searchResultsListViewClass+" "+a.continueButtonClass,"click",c.proxy(this.handleSearchContinueButtonClick,this));this.tradeInWrapper.delegate(a.searchResultsListViewClass+" "+a.backButtonClass,"click",c.proxy(this.handleSearchContinueButtonClick,this));this.tradeInWrapper.delegate(a.eligibleListViewClass+" .search-remove","click",c.proxy(this.handleSearchItemRemoveClick,
this));l.on("a:popover:beforeHide:"+this.tradeInViewInstanceName,c.proxy(function(){for(var a=0;a<this.selectedEligibleItems.length;a++){var c=this.selectedEligibleItems[a];c.hasBeenGraded&&this.isItemInListByAsin(c,this.selectedSearchResultItems)&&(this.spliceItemFromList(c,this.selectedSearchResultItems),this.saveState())}},this))},bindAutoComplete:function(){c(".tradein-autocomplete-dropdown-menu").remove();var b=this,g=a.autoCompleteUrl;b.config.hasOwnProperty("autoCompleteUrlDomain")&&b.config.autoCompleteUrlDomain&&
(g=b.config.autoCompleteUrlDomain+a.autoCompleteUrlSuffix);new w({selector:a.tradeInWrapperClass+" "+this.navCurrentView+" "+this.searchInputClass,minChars:1,cache:!1,menuClass:"tradein-autocomplete-dropdown-menu",source:function(a,d){a&&a.trim().length&&c.ajax({type:"GET",url:g,data:{prefix:a,alias:"amazon-devices",mid:b.config.marketplace,"client-id":"tradein-search-suggestion"},dataType:"json",success:function(a){var n=[];a&&a.hasOwnProperty("suggestions")&&c.each(a.suggestions,function(a,b){n.push(b.value)});
b.searchIsInProgress||d(n)},error:function(){h.recordError("Autocomplete error","Error encountered during autocomplete request")}})},onSelect:function(c,g){b.tradeInSearchCurrentCacheEntry=b.getSearchResultsCacheEntry(g);0===b.tradeInSearchCurrentCacheEntry.eligibleItems.length?b.doTradeInSearch(a.tradeInSearchResultsLoadContext):(b.navCurrentView=a.searchResultsListViewClass,b.createView())}})},doTradeInSearch:function(b){if(!this.searchIsInProgress){this.searchIsInProgress=!0;c(a.searchSuggestionsClass).hide();
this.recordRefTag(a.refTagSearchTermRequest+this.tradeInSearchCurrentCacheEntry.term);if(b===a.tradeInSearchResultsScrollContext){var g=this.tradeInWrapper.find(a.searchResultsListViewClass+" "+a.searchLoadingSpinnerClass);g.addClass("active")}else this.loadingSpinnerShow();var d={"search-alias":a.tradeInSearchAlias,keyword:this.tradeInSearchCurrentCacheEntry.term,pageIndex:this.tradeInSearchCurrentCacheEntry.currentPageIndex,pageSize:a.tradeInSearchPageSize,pageRefinements:!0,requestToken:this.getCsrfTokenByKey(a.csrfSearchRequestKey)};
if(this.config.hasOwnProperty("searchConfigurations")){var f=this.config.searchConfigurations;f.hasOwnProperty("searchAlias")&&(d["search-alias"]=f.searchAlias);f.hasOwnProperty("searchNode")&&(d.node=f.searchNode)}l.post(this.tradeInSearchUrl,{params:d,success:c.proxy(function(e){this.updateCsrfTokenByKey(a.csrfSearchRequestKey,e);this.searchIsInProgress=!1;this.tradeInSearchCurrentCacheEntry.currentPageSize+=e.pageSize;this.tradeInSearchCurrentCacheEntry.totalAvailableResults=e.totalAvailableResults;
e.hasOwnProperty("questionnaires")&&(this.config.questionnaires=c.extend(this.config.questionnaires,e.questionnaires));var n=null;e.hasOwnProperty("eligibleItems")&&(n=Object.keys(e.eligibleItems).map(function(a){return e.eligibleItems[a]}));n&&(this.tradeInSearchCurrentCacheEntry.eligibleItems=c.merge(this.tradeInSearchCurrentCacheEntry.eligibleItems,n));b===a.tradeInSearchResultsScrollContext?(this.tradeInSearchCurrentCacheEntry.currentPageIndex!==e.pageIndex&&(this.tradeInSearchCurrentCacheEntry.currentPageIndex=
e.pageIndex),g.removeClass("active"),n&&(this.createTemplatesByIterable(n,this.searchResultItemTemplate,this.tradeInWrapper.find(".tradein-search-result-list")),this.validateMaxSelectedItems())):(this.loadingSpinnerHide(),this.navCurrentView=a.searchResultsListViewClass,this.createView())},this),error:c.proxy(function(a){this.searchIsInProgress=!1;this.handleRequestError(a,"TradeIn search error","Error encountered during TradeIn search request")},this)})}},doTradeInReviewValidation:function(b){this.hasPendingRequest||
(this.loadingSpinnerShow(),this.hasPendingRequest=!0,l.post(this.tradeInReviewUrl,{params:{currentAsin:h.getCurrentAsin(),requestToken:this.getCsrfTokenByKey(a.csrfReviewRequestKey)},success:c.proxy(function(c){this.updateCsrfTokenByKey(a.csrfReviewRequestKey,c);this.tradeInReviewData=c;this.loadingSpinnerHide();this.hasPendingRequest=!1;b()},this),error:c.proxy(function(b){this.hasPendingRequest=!1;b.hasOwnProperty("http")&&b.http.status===a.maxTradeInItemQuantityStatusCode?this.handleMaxQuantityError():
this.handleRequestError(b,"TradeIn review error","Error encountered during TradeIn review request")},this)}))},doTradeInItemRemove:function(b){this.loadingSpinnerShow();l.post(this.tradeInRemoveItemUrl,{params:{asin:b.asin,decline:!0,requestToken:this.getCsrfTokenByKey(a.csrfRemoveRequestKey)},success:c.proxy(function(b){this.updateCsrfTokenByKey(a.csrfRemoveRequestKey,b);this.loadingSpinnerHide()},this),error:c.proxy(function(a){this.handleRequestError(a,"TradeIn deselect remove error","Error encountered during TradeIn deselect remove request")},
this)})},doTradeInSubmit:function(b){this.hasPendingRequest||c(b.currentTarget).hasClass("a-button-disabled")||(this.loadingSpinnerShow(),this.hasPendingRequest=!0,b=this.instantPaymentEligible?"ip":"nip",this.customerIpPreference||(this.customerIpPreference=a.instantPaymentNow),this.instantPaymentMixed&&(b="mb"),l.post(this.tradeInSubmitUrl+b,{params:{requestToken:this.getCsrfTokenByKey(a.csrfSubmitRequestKey),customerIpPreference:this.customerIpPreference,currentAsin:h.getCurrentAsin()},success:c.proxy(function(b){this.tradeInSubmitData=
b;try{if(this.tradeInSubmitData.hasOwnProperty("mfaUrl")&&this.tradeInSubmitData.mfaUrl){h.redirectToMFA(this.tradeInSubmitData.mfaUrl);return}r.sessionStorage&&(r.sessionStorage.removeItem("tradein-state"),this.promotionEligible&&(this.promosApplied.push({productGroup:this.tradeInProductGroup,applied:!0}),r.sessionStorage.setItem("tradein-promos-applied",JSON.stringify(this.promosApplied))))}catch(c){h.recordError(c,a.sessionStorageAccessErrorMsg)}l.trigger("tanookiSuccess");this.loadingSpinnerHide();
this.hasPendingRequest=!1;this.updateLaunchButtonText();this.navCurrentView=a.successfulViewClass;this.createView()},this),error:c.proxy(function(b){this.hasPendingRequest=!1;b.hasOwnProperty("http")&&b.http.status===a.maxTradeInItemQuantityStatusCode?this.handleMaxQuantityError():this.handleRequestError(b,"TradeIn submit error","Error encountered during TradeIn submit request")},this)}))},addNavHistory:function(a){this.navHistory.push(a)},popNavHistory:function(){if(1<this.navHistory.length)return this.navHistory.pop(),
this.navHistory.pop()},createView:function(){this.hideAllViews();switch(this.navCurrentView){case a.searchResultsListViewClass:this.recordRefTag(a.refTagSearchItemsView);this.createSearchResultsView();break;case a.selectedItemConditionViewClass:this.recordRefTag(a.refTagConditionView);this.createConditionView();break;case a.selectedItemsConfirmationViewClass:this.recordRefTag(a.refTagConfirmationView);this.createConfirmationView();break;case a.successfulViewClass:this.recordRefTag(a.refTagSuccessfulView);
this.createSuccessfulView();break;default:this.recordRefTag(a.refTagListItemsView),this.createEligibleListView()}},createEligibleListView:function(){var b=this.config;if(-1===c.inArray(this.navCurrentView,this.boundedViews)){var g=d.bindDataToTemplate(this.eligibleListViewTemplate,{instantPayable:this.config.hasOwnProperty("instantPayable")?this.config.instantPayable:!1});g.find(a.eligibleItemsCountId).html(b.eligibleItems.length);var p=g.find(a.eligibleItemListClass);this.createTemplatesByIterable(b.eligibleItems,
this.eligibleItemTemplate,p);if(0<this.selectedSearchResultItems.length){var f=0,e=g.find(".tradein-search-item-list");c.each(this.selectedSearchResultItems,c.proxy(function(a,b){if(this.config.hasOwnProperty("validTradeInItemTypes")&&-1===c.inArray(b.tradeInItemType,this.config.validTradeInItemTypes))return!0;b.fromSearch=!0;a=d.bindDataToTemplate(this.eligibleItemTemplate,b);a.data("templateModel",b);e.append(a);f++},this));0<f&&(g.find(".search-result-wrapper").addClass("active"),g.find("#searchedSelectedItems").html(f))}this.tradeInWrapper.append(g);
this.hasInitiallyLoaded||c.each(b.eligibleItems,c.proxy(function(a,b){b.selected&&this.createSelectedItem(b)},this));var n=this;c.each(this.tradeInWrapper.find(".selectable-wrapper .selectable-item"),function(){var b=c(this),e=n.getDataModel(b);c.each(n.selectedEligibleItems,function(c,d){b.hasClass("disabled")||d.asin!==e.asin||d.deviceId!==e.deviceId||(b.addClass("selected").removeClass("disabled"),b.find('input[type\x3d"checkbox"]').prop("checked",!0).prop("disabled",!1),n.toggleEligibleItemsSelectableStateByAsin(d.asin,
!1),g.find(".a-button-disabled").removeClass("a-button-disabled").find("button").prop("disabled",!1),n.toggleReviewTradeInItemsSubmitState(a.itemSelectEligibleContext))})});this.bindAutoComplete();this.boundedViews.push(this.navCurrentView);this.hasInitiallyLoaded=!0}p=this.tradeInWrapper.find(".no-eligible-items");0===b.eligibleItems.length&&0===this.selectedEligibleItems.length?p.show():p.hide();this.updateSelectedCountValueHeader();this.validateMaxSelectedItems();this.tradeInWrapper.find(a.eligibleListViewClass).show();
this.navHistory.push(this.navCurrentView)},createConditionView:function(){-1===c.inArray(this.navCurrentView,this.boundedViews)&&(c.each(this.selectedEligibleItems,c.proxy(function(b,g){var p=d.bindDataToTemplate(this.selectedItemConditionViewTemplate,g);this.updateConditionViewHeaderCount(p,b+1);b="";for(var f=g.tradeInQuestions,e=0;e<f.length;e++){for(var n=f[e],t="",z=d.bindDataToTemplate(this.questionRadioButtonTemplate,n),y=0;y<n.choices.length;y++)t+=d.bindDataToTemplate(this.radioButtonTemplate,
{questionId:n.id},n.choices[y])[0].outerHTML;z.find(".tradein-question-choice-list").append(t);b+=z[0].outerHTML}this.config.hasOwnProperty("deviceTradeInFlavor")&&"promo_only"===this.config.deviceTradeInFlavor||(b+=d.bindDataToTemplate(this.questionRadioTemplate)[0].outerHTML);p.find(".conditions-question-list").append(b);for(var k in g.tradeInQuestionResponses)if(g.tradeInQuestionResponses.hasOwnProperty(k)){var l=g.tradeInQuestionResponses[k];k===a.appraisalInputName?p.find('input[name\x3d"'+k+
'"][value\x3d"'+l+'"]').prop("checked",!0):p.find('button[name\x3d"'+k+'"]').each(function(){c(this).val()===l&&c(this).closest(".a-button-toggle").addClass("a-button-selected").attr("aria-checked",!0)})}p.attr("id","conditionGrade_"+g.asin);k=h.getSortedConditionTradeInValues(g);b=p.find(".conditions-question-list .adjusted-pricing-range");b.find("#adjustedPriceLow").html(h.formatCurrency(k[0]));b.find("#adjustedPriceHigh").html(h.formatCurrency(k[k.length-1]));b.removeClass("aok-hidden");this.tradeInWrapper.append(p);
p.data("templateModel",g)},this)),this.boundedViews.push(this.navCurrentView));this.getIsAllGraded()?(this.tradeInWrapper.find(a.eligibleListViewClass).show(),this.doTradeInReviewValidation(c.proxy(function(){this.navCurrentView=this.navViews.selectedItemsConfirmationView;this.goToView()},this))):c.each(this.selectedEligibleItems,c.proxy(function(b,c){b="#conditionGrade_"+c.asin;var d=this.tradeInWrapper.find(b);if(0!==d.length)if(c.hasBeenGraded)d.removeClass("active");else return d.addClass("active").show(),
d.find('input[name\x3d"'+a.appraisalInputName+'"][value\x3d"'+a.appraisalAccept+'"]').prop("checked",!0),this.toggleNextConditionSubmitState(c),this.navHistory.push(b),!1},this))},createConfirmationView:function(){this.tradeInWrapper.find(a.selectedItemsConfirmationViewClass).remove();this.instantPaymentEligible=this.tradeInReviewData.hasOwnProperty("instantPaymentEligible")?this.tradeInReviewData.instantPaymentEligible:!1;this.instantPaymentMixed=this.tradeInReviewData.hasOwnProperty("orderTotalPaidInstantly")&&
0<this.tradeInReviewData.orderTotalPaidInstantly&&0<(this.tradeInReviewData.hasOwnProperty("orderTotalPaidOnGrading")&&this.tradeInReviewData.orderTotalPaidOnGrading);this.promotionEligible=this.tradeInReviewData.hasOwnProperty("promotionEligible")?this.tradeInReviewData.promotionEligible:!1;var b=this.instantPaymentEligible?a.refTagReviewInstantPaymentView:a.refTagReviewNonInstantPaymentView;this.instantPaymentMixed&&(b=a.refTagReviewMixedBagPaymentView);this.recordRefTag(b);var g=this.tradeInReviewData.hasOwnProperty("sanitizedItemsList")&&
c.isArray(this.tradeInReviewData.sanitizedItemsList)?this.tradeInReviewData.sanitizedItemsList:[],b=d.bindDataToTemplate(this.selectedItemsConfirmationViewTemplate,{instantPayable:this.instantPaymentEligible,promotionEligible:this.promotionEligible});if(this.tradeInReviewData.hasOwnProperty("promotionEligibilityText")){var p="";c.each(this.tradeInReviewData.promotionEligibilityText,function(a,b){p+=b});b.find(".tradeInPromotion #promotionText").html(p)}var q="",e=!1;c.each(this.selectedEligibleItems,
c.proxy(function(a,b){var n=!1;c.each(g,function(a,c){if(c.asin===b.asin)return n=!0,b.instantPayable=c.instantPayable,b.tradeInValue=c.tradeInValue,!1});n||(e=!0,this.tradeInReviewData.hasOwnProperty("nonTradeableItems")&&this.isItemInListByAsin(b,this.tradeInReviewData.nonTradeableItems)?b.nonTradeableItems=!0:this.tradeInReviewData.hasOwnProperty("qtyLimitExceedItems")&&this.isItemInListByAsin(b,this.tradeInReviewData.qtyLimitExceedItems)?b.qtyLimitExceedItems=!0:b.unknownErrorState=!0);q+=d.bindDataToTemplate(this.itemConfirmationTemplate,
b)[0].outerHTML},this));b.find(".tradein-confirmation-item-list").append(q);var n=!1;this.tradeInReviewData.hasOwnProperty("defaultReturnAddressId")&&this.tradeInReviewData.defaultReturnAddressId?this.tradeInReviewData.hasOwnProperty("freeShipping")&&this.tradeInReviewData.freeShipping?e&&b.find(".alert-wrapper").append(c(".tradein-templates .tradein-info-submit-updates").clone()).addClass("active"):(n=!0,b.find(".alert-wrapper").append(c(".tradein-templates .tradein-info-submit-invalid-address-error").clone()).addClass("active")):
(n=!0,b.find(".alert-wrapper").append(c(".tradein-templates .tradein-info-submit-address-error").clone()).addClass("active"),b.find(".tradein-appraisal-info").hide());v.isEnabled&&this.tradeInReviewData.showOfflineOption&&(this.showOfflineOption=!0,this.offlineDropOffLocations=this.tradeInReviewData.nearbyProcessors,b.find("#weWantYouToKnow #weWantYouToKnowExpanderContent").append(this.dropOffBannerNoLinkTemplate));b.find(".tradeInShipDate").html(this.tradeInReviewData.shipByDateString);b.find(".labelEmail").html(this.tradeInReviewData.emailAddress);
b.find("#tradeInTotalValue").html(h.formatCurrency(this.tradeInReviewData.orderTotalGC));b.find(".selectedItemTotalCount").html(g.length);b.find("#returnAddress").html(d.bindDataToTemplate(c("#addressLineTemplate"),this.tradeInReviewData.defaultReturnAddress));this.tradeInWrapper.append(b);this.toggleMixedBasketElements(b);if(n||0===g.length)b.find(".payment-breakdown").hide(),k(a.tradeInWrapperClass+" #confirmTradeInSubmit").disable();this.instantPaymentEligible&&this.tradeInReviewData.hasOwnProperty("isMFAMarketplace")&&
this.tradeInReviewData.isMFAMarketplace&&(f.isEnabled&&this.tradeInWrapper.find(".instantPaymentPreference-wrapper").removeClass("aok-hidden"),this.tradeInWrapper.find(".instantPaymentPreference-mfa").removeClass("aok-hidden"));this.navHistory.push(this.navCurrentView)},createSuccessfulView:function(){var b=d.bindDataToTemplate(this.successfulTradeInViewTemplate,{instantPayable:this.customerIpPreference===a.instantPaymentNow&&this.instantPaymentEligible,promotionEligible:this.promotionEligible});
l.objectIsEmpty(this.tradeInSubmitData)||(b.find("#tradeInTotalValue").html(h.formatCurrency(this.tradeInSubmitData.totalAmount)),b.find(".tradeInShipDate").html(this.tradeInSubmitData.shipByDate),b.find(".labelEmail").html(this.tradeInSubmitData.customerEmailAddress),b.find(".customerEmail").html(this.tradeInSubmitData.customerEmailAddress));v.isEnabled&&this.tradeInReviewData.showOfflineOption&&(this.showOfflineOption=!0,this.offlineDropOffLocations=this.tradeInReviewData.nearbyProcessors,this.createNearbyProcessorExpander(),
b.find(".content-wrapper").append(this.dropOffLocationExpander));this.tradeInWrapper.append(b);this.toggleMixedBasketElements(b)},createSearchResultsView:function(){this.tradeInWrapper.find(a.searchResultsListViewClass).remove();var b=d.bindDataToTemplate(this.searchResultsListViewTemplate);b.find("#searchTerm").html(this.tradeInSearchCurrentCacheEntry.term);if(this.tradeInSearchCurrentCacheEntry.hasOwnProperty("eligibleItems")){var g=this.tradeInSearchCurrentCacheEntry.eligibleItems,p=b.find(a.searchResultListClass);
this.createTemplatesByIterable(g,this.searchResultItemTemplate,p);p.bind("scroll",c.proxy(this.handleSearchScroll,this))}this.tradeInWrapper.append(b);this.tradeInWrapper.find(".search-input").val(this.tradeInSearchCurrentCacheEntry.term);this.bindAutoComplete();this.validateMaxSelectedItems();this.navHistory.push(this.navCurrentView)},createTemplatesByIterable:function(a,g,p){c.each(a,c.proxy(function(a,b){a=d.bindDataToTemplate(g,b);a.data("templateModel",b);p.append(a)},this))},createSelectedItem:function(b){if(!this.isItemInListByAsin(b,
this.selectedEligibleItems)){var g={hasBeenGraded:!1,gradedCondition:null,tradeInQuestions:this.getQuestionsByItem(b),tradeInValue:b.tradeInValue,tradeInQuestionResponses:{appraisal:a.appraisalAccept}},g=c.extend(!0,{},g,b);this.selectedEligibleItems.push(g)}},createReturnAddressInstance:function(a){if(this.tradeInReviewData&&0<a.length)if(0===a.children().length){for(var g in this.tradeInReviewData.returnAddresses)if(this.tradeInReviewData.returnAddresses.hasOwnProperty(g)){var p=this.tradeInReviewData.returnAddresses[g];
p.formalAddress=d.bindDataToTemplate(c("#addressLineFormalTemplate"),p);var f=d.bindDataToTemplate(c("#addressLineItemTemplate"),p),e=this.tradeInReviewData.defaultReturnAddressId===p.addressId;f.find('input[type\x3d"radio"]').val(p.addressId).prop("checked",e);f.data("templateModel",p);a.append(f)}a.delegate('input[type\x3d"radio"]',"change",c.proxy(this.handleReturnAddressChange,this))}else a=a.find('input[type\x3d"radio"]'),c.each(a,c.proxy(function(a,b){a=c(b);a.prop("checked",a.val()===this.tradeInReviewData.defaultReturnAddressId)},
this))},saveState:function(){try{r.sessionStorage&&r.sessionStorage.setItem("tradein-state",JSON.stringify({selectedSearchResultItems:this.selectedSearchResultItems}))}catch(b){h.recordError(b,a.sessionStorageAccessErrorMsg)}},cleanState:function(){this.selectedEligibleItems=[];this.selectedSearchResultItems=[];this.navHistory=[];this.boundedViews=[];this.navCurrentView=null;this.hasInitiallyLoaded=!1;c(a.searchSuggestionsClass).remove()},restoreFromState:function(){try{if(r.sessionStorage){var b=
r.sessionStorage.getItem("tradein-state");b&&(this.selectedSearchResultItems=this.extractStateFromStorage(b).selectedSearchResultItems);var c=r.sessionStorage.getItem("tradein-promos-applied");c&&(this.promosApplied=this.extractStateFromStorage(c))}}catch(d){h.recordError(d,a.sessionStorageAccessErrorMsg)}},extractStateFromStorage:function(a){try{var c=l.parseJSON(a);if(!l.objectIsEmpty(c))return c}catch(d){h.recordError(d,"SessionStorage state JSON parse error")}},hideAllViews:function(){this.tradeInWrapper.children().each(function(){c(this).hide()})},
goToView:function(){this.saveState();this.createView()},handleSearchScroll:function(b){var c=this.tradeInWrapper.find(a.searchResultListClass);if(0<c.length){b=c.height();b=c.scrollTop()+b;var c=c[0].scrollHeight-120,d=Math.ceil(this.tradeInSearchCurrentCacheEntry.totalAvailableResults/a.tradeInSearchPageSize);!this.searchIsInProgress&&this.tradeInSearchCurrentCacheEntry.currentPageIndex<d&&b>=c&&(this.tradeInSearchCurrentCacheEntry.currentPageIndex+=1,this.doTradeInSearch(a.tradeInSearchResultsScrollContext))}},
handleSearchFormSubmit:function(b){b.preventDefault();b=c(b.currentTarget);var g=b.find(".search-input");if(!g.is("input")&&(g=b.find(".search-input input"),!g.is("input")))return;if(b=l.trim(g.val()))this.tradeInSearchCurrentCacheEntry=this.getSearchResultsCacheEntry(b),0===this.tradeInSearchCurrentCacheEntry.eligibleItems.length?this.doTradeInSearch(a.tradeInSearchResultsLoadContext):(this.navCurrentView=a.searchResultsListViewClass,this.createView())},handleSearchItemRemoveClick:function(b){b=
c(b.currentTarget);b.closest(".selectable-item").hasClass("disabled")||(b=this.getDataModel(b),this.recordRefTag(a.refTagSearchItemRemoveClick),this.isItemInListByAsin(b,this.selectedEligibleItems)&&this.doTradeInItemRemove(b),this.spliceItemFromList(b,this.selectedSearchResultItems),this.spliceItemFromList(b,this.selectedEligibleItems),this.handleSearchContinueButtonClick())},handleSearchContinueButtonClick:function(){this.tradeInSearchCurrentCacheEntry=null;this.tradeInWrapper.find(a.eligibleListViewClass).remove();
delete this.boundedViews[this.boundedViews.indexOf(a.eligibleListViewClass)];this.navCurrentView=this.navViews.eligibleListView;this.addNavHistory(this.navCurrentView);this.goToView()},handleContinueButtonClick:function(b){b=c(b.currentTarget);var g=this.getDataModel(b);this.recordRefTag(a.refTagConditionContinueClick);this.loadingSpinnerShow();b={asin:g.asin,condition:g.gradedCondition,returnOption:g.tradeInQuestionResponses.appraisal,requestToken:this.getCsrfTokenByKey(a.csrfSaveGradedItemKey)};
g.hasOwnProperty("deviceId")&&g.deviceId&&(b.deviceId=g.deviceId);l.post(this.tradeInSaveGradedItemConditionUrl,{params:b,success:c.proxy(function(b){this.updateCsrfTokenByKey(a.csrfSaveGradedItemKey,b);this.loadingSpinnerHide();g.hasBeenGraded=!0;this.recordRefTag(a.refTagGradedConditionClick+g.gradedCondition.toLowerCase());this.getIsAllGraded()?(this.tradeInWrapper.find(a.continueButtonClass).each(function(){c(this).removeClass("a-button-disabled").addClass("active");c(this).find("button").prop("disabled",
!1)}),this.doTradeInReviewValidation(c.proxy(function(){this.navCurrentView=this.navViews.selectedItemsConfirmationView;this.goToView()},this))):(this.navCurrentView=this.navViews.selectedItemConditionView,this.goToView())},this),error:c.proxy(function(a){this.handleRequestError(a,"TradeIn save graded condition error","Error encountered during TradeIn save graded condition request")},this)})},handleBackButtonClick:function(){var b=this.popNavHistory();if(b)if(this.navCurrentView=b,this.addNavHistory(b),
this.recordRefTag(a.refTagBackClick),b===a.eligibleListViewClass)this.resetEligibleListView(),this.createView();else{this.hideAllViews();var g=this.tradeInWrapper.find(b);-1!==b.indexOf("conditionGrade_")&&(this.tradeInWrapper.find(".tradein-selected-item-condition-view").each(function(){c(this).removeClass("active")}),g.addClass("active"),b=b.split("_"),1<b.length&&this.restoreViewButtonState(g,b[1]));g.show();g.find(".selectable-wrapper").scrollTop(0)}},handleSelectableItemClick:function(b,g){var d=
c(b.currentTarget);b=d.closest(".selectable-item");if(!b.hasClass("disabled")){var f=this.getDataModel(b);if(f){if(b.hasClass("selected"))g===a.itemSelectSearchContext&&this.spliceItemFromList(f,this.selectedSearchResultItems),g===a.itemSelectEligibleContext&&this.isItemInListByAsin(f,this.selectedEligibleItems)&&this.doTradeInItemRemove(f),this.spliceItemFromList(f,this.selectedEligibleItems),b.removeClass("selected"),this.toggleEligibleItemsSelectableStateByAsin(f.asin,!0),this.recordRefTag(a.refTagItemDeSelect),
this.hideAlert();else{if(this.validateMaxGiftCardAmount(f)){this.showAlert(this.alertMaxGCValueWarningClass,b);d.prop("checked",!1);return}g!==a.itemSelectSearchContext||this.isItemInListByAsin(f,this.selectedSearchResultItems)||(this.recordRefTag(a.refTagSearchItemSelect),d=c.extend({},f),d.fromSearch=!0,this.selectedSearchResultItems.push(d));this.createSelectedItem(f);b.addClass("selected");this.toggleEligibleItemsSelectableStateByAsin(f.asin,!1);this.recordRefTag(a.refTagItemSelect)}this.updateSelectedCountValueHeader();
this.validateMaxSelectedItems();this.toggleReviewTradeInItemsSubmitState(g);this.saveState()}}},handleQuestionButtonClick:function(a){var g=c(a.currentTarget),d=g.find("button"),g=this.getDataModel(g);g.tradeInQuestionResponses[d.attr("name")]=d.val();this.toggleNextConditionSubmitState(g,c(a.currentTarget).closest(".tradein-question-wrapper"))},handleAppraisalRadioChange:function(b){b=c(b.currentTarget);var g=this.getDataModel(b);g.tradeInQuestionResponses[b.attr("name")]=b.val();this.recordRefTag(b.val()===
a.appraisalReturn?a.refTagAppraisalReturn:a.refTagAppraisalAccept);this.toggleNextConditionSubmitState(g)},handleIpPreferenceRadioChange:function(b){this.customerIpPreference=c(b.currentTarget).val();this.customerIpPreference===a.instantPaymentNow&&this.tradeInReviewData.hasOwnProperty("isMFAMarketplace")&&this.tradeInReviewData.isMFAMarketplace?this.tradeInWrapper.find(".instantPaymentPreference-mfa").removeClass("aok-hidden"):this.tradeInWrapper.find(".instantPaymentPreference-mfa").addClass("aok-hidden")},
handleConfirmDeleteClick:function(b){this.recordRefTag(a.refTagDeleteClick);var g=c(b.currentTarget).data("asin"),d=null;c.each(this.selectedEligibleItems,c.proxy(function(a,b){if(b.asin===g)return d=b,this.tradeInWrapper.find("#conditionGrade_"+g).remove(),this.selectedEligibleItems.splice(a,1),!1},this));d&&(this.loadingSpinnerShow(),l.post(this.tradeInRemoveItemUrl,{params:{asin:d.asin,decline:!0,requestToken:this.getCsrfTokenByKey(a.csrfRemoveRequestKey)},success:c.proxy(function(b){this.updateCsrfTokenByKey(a.csrfRemoveRequestKey,
b);this.loadingSpinnerHide();c.each(this.config.eligibleItems,function(a,b){b.asin===g&&(b.condition=null)});0===this.selectedEligibleItems.length?(k(a.eligibleListViewClass+" "+a.reviewTradeInItemsSubmitId).disable(),this.tradeInWrapper.find(a.eligibleListViewClass+" .selectable-item").each(function(){c(this).removeClass("selected").removeClass("disabled");c(this).find('input[type\x3d"checkbox"]').prop("checked",!1).prop("disabled",!1)}),this.resetEligibleListView(),this.navCurrentView=this.navViews.eligibleListView,
this.goToView()):this.doTradeInReviewValidation(c.proxy(function(){this.navCurrentView=this.navViews.selectedItemsConfirmationView;this.goToView()},this))},this),error:c.proxy(function(a){this.handleRequestError(a,"TradeIn remove item from past purchase list error","Error encountered during TradeIn remove item from past purchases request")},this)}))},handleConfirmChangeClick:function(b){this.hideAllViews();this.navCurrentView=this.navViews.selectedItemConditionView;this.recordRefTag(a.refTagChangeConditionClick);
var g=c(b.currentTarget).data("asin");b=this.tradeInWrapper.find("#conditionGrade_"+g);var d=1;c.each(this.selectedEligibleItems,function(a,b){if(b.asin===g)return d=a+1,!1});this.updateConditionViewHeaderCount(b,d);b.find(a.backButtonClass).hide();b.find(a.continueButtonClass).addClass("active");b.addClass("active").show();b.find(".scrollable-list").scrollTop(0);this.restoreViewButtonState(b,g)},handleLoginPrompt:function(){this.recordRefTag(a.refTagLogInPrompt);var b=this.tradeInWrapper.find(this.navCurrentView+
" .content-wrapper"),g=c("#alertTemplates "+a.alertPromptLoginClass).clone();b.html("").append(g).addClass("logged-out-message")},handleRequestError:function(b,g,d){this.loadingSpinnerHide();b.http.status===a.unauthorizedCode?this.handleLoginPrompt():(h.recordError(g,d),this.tradeInWrapper.find(this.navCurrentView+" .alert-wrapper").html("").prepend(c(".tradein-templates .tradein-general-error").clone()).addClass("active"))},handleReturnAddressChange:function(b){this.recordRefTag(a.refTagReturnAddressUpdateRequest);
this.loadingSpinnerShow();l.post(this.tradeInReviewUrl,{params:{addressId:b.val(),requestToken:this.getCsrfTokenByKey(a.csrfReviewRequestKey)},success:c.proxy(function(b){this.updateCsrfTokenByKey(a.csrfReviewRequestKey,b);this.loadingSpinnerHide();this.tradeInReviewData=b;this.navCurrentView=this.navViews.selectedItemsConfirmationView;this.goToView()},this),error:c.proxy(function(a){this.handleRequestError(a,"TradeIn return address error","Error encountered during TradeIn return address update request")},
this)})},handleMaxQuantityError:function(){this.loadingSpinnerHide();this.selectedEligibleItems=[];this.resetEligibleListView();this.navCurrentView=this.navViews.eligibleListView;this.goToView();this.showAlert(a.alertMaxItemQuantityBannerClass)},toggleEligibleItemsSelectableStateByAsin:function(b,g){c.each(this.tradeInWrapper.find("li.tradein-eligible-item .selectable-item"),c.proxy(function(d,f){f=c(f);d=f.find('input[type\x3d"checkbox"]');var e=this.getDataModel(f);e&&e.asin===b&&(g?(f.find(".tradein-item-info "+
a.alertMaxItemQuantityClass).remove(),f.removeClass("disabled").removeClass("maxasin"),d.prop("disabled",!1)):f.hasClass("selected")||g||(f.addClass("disabled").addClass("maxasin"),d.prop("disabled",!0)))},this))},toggleAllEligibleItemsSelectableState:function(a){c.each(this.tradeInWrapper.find("li .selectable-item"),c.proxy(function(g,d){d=c(d);g=d.find('input[type\x3d"checkbox"]');d.hasClass("selected")||d.hasClass("maxasin")||(a?(d.removeClass("disabled"),g.prop("disabled",!1)):(d.addClass("disabled"),
g.prop("disabled",!0)))},this))},toggleReviewTradeInItemsSubmitState:function(b){b=k(b===a.itemSelectSearchContext?a.tradeInWrapperClass+" "+a.searchResultsListViewClass+" "+a.continueButtonClass:a.tradeInWrapperClass+" "+a.reviewTradeInItemsSubmitId);0<this.selectedEligibleItems.length?b.enable():b.disable()},toggleNextConditionSubmitState:function(b,d){var f=[a.appraisalInputName];c.each(b.tradeInQuestions,function(a,b){b.hasOwnProperty("id")&&f.push(b.id)});var h=!0,e=!1;c.each(f,c.proxy(function(a,
c){"Unacceptable"===b.tradeInQuestionResponses[c]&&(e=!0,h=!1);b.tradeInQuestionResponses.hasOwnProperty(c)||(h=!1)},this));e?this.showAlert(this.alertItemAcceptableClass,d):this.hideAlert();d=k(a.selectedItemConditionViewClass+".active "+a.continueButtonClass);h?(this.setGradedCondition(b),d.enable()):d.disable()},toggleMixedBasketElements:function(a){this.instantPaymentMixed?(a.find("#paidInstantAmount").html(h.formatCurrency(this.tradeInReviewData.orderTotalPaidInstantly)),a.find("#paidNonInstantAmount").html(h.formatCurrency(this.tradeInReviewData.orderTotalPaidOnGrading)),
a.find(".mixed-basket #tradeInTotalValue").html(h.formatCurrency(this.tradeInReviewData.orderTotalPaidInstantly)),a.find(".non-mixed-basket").hide(),a.find(".mixed-basket").show(),a.find(".paid-breakdown-wrapper").show()):(a.find(".non-mixed-basket").show(),a.find(".mixed-basket").hide(),a.find(".paid-breakdown-wrapper").hide())},restoreViewButtonState:function(a,d){c.each(this.selectedEligibleItems,c.proxy(function(f,h){if(h.asin===d){for(var e in h.tradeInQuestionResponses)if(h.tradeInQuestionResponses.hasOwnProperty(e)){var n=
h.tradeInQuestionResponses[e];a.find('input[type\x3d"radio"][name\x3d"'+e+'"]').each(function(){c(this).val()===n&&c(this).prop("checked",!0)})}this.toggleNextConditionSubmitState(h)}},this))},resetEligibleListView:function(){this.tradeInWrapper.find(a.selectedItemConditionViewClass).remove();delete this.boundedViews[this.boundedViews.indexOf(a.selectedItemConditionViewClass)];this.tradeInWrapper.find(a.eligibleListViewClass).remove();delete this.boundedViews[this.boundedViews.indexOf(a.eligibleListViewClass)]},
getTradeInTotalValue:function(){var a=0;c.each(this.selectedEligibleItems,function(c,d){a+=d.tradeInValue});return a},getIsAllGraded:function(){var a=!0;c.each(this.selectedEligibleItems,function(c,d){if(!d.hasBeenGraded)return a=!1});return a},getDataModel:function(a){return a.closest("*[data-template-model]").data("templateModel")},getConditionWeightageMap:function(a){var d=[],f={},h;for(h in a.conditionOfferMap)a.conditionOfferMap.hasOwnProperty(h)&&d.push([h,a.conditionOfferMap[h].tiv]);d.sort(function(a,
b){return b[1]-a[1]});c.each(d,function(a,b){f[b[0]]=a});return f},getSearchResultsCacheEntry:function(a){for(var c=0;c<this.searchResultsCache.length;c++){var d=this.searchResultsCache[c];if(d.term===a)return d}d={term:a,eligibleItems:[],currentPageSize:0,currentPageIndex:1,totalAvailableResults:0};this.searchResultsCache.push(d);return d},getQuestionsByItem:function(a){return this.config.hasOwnProperty("questionnaires")&&this.config.questionnaires[a.tradeInItemType]&&this.config.questionnaires[a.tradeInItemType].hasOwnProperty("questions")?
this.config.questionnaires[a.tradeInItemType].questions:[]},getCsrfTokenByKey:function(b){return this.config.hasOwnProperty(a.csrfKeyMap)&&this.config[a.csrfKeyMap][b]?this.config[a.csrfKeyMap][b]:""},isItemInListByAsin:function(a,c){for(var d=0;d<c.length;d++)if(c[d].asin===a.asin)return!0;return!1},setGradedCondition:function(b){var d=this.getConditionWeightageMap(b),f=[],k=null;c.each(b.tradeInQuestionResponses,function(b,n){b!==a.appraisalInputName&&f.push(d[n])});var e=l.reduce(f,function(a,
b){return b&&b>a?b:a},0);c.each(d,function(a,b){if(b===e)return k=a,!1});b.gradedCondition=k;b.tradeInValue=b.conditionOfferMap[k].tiv;var n=this.tradeInWrapper.find("#conditionGrade_"+b.asin);n.find("#estimatedTiv").html(h.formatCurrency(b.tradeInValue));var t=h.getSortedConditionTradeInValues(b);b=t.indexOf(b.tradeInValue);t.length&&-1!==b&&(n.find(".appraisal-choose-label").css("visibility","visible"),n.find(".appraisal-wrapper").css("visibility","visible"),n.find(".adjusted-pricing").each(function(){c(this).addClass("aok-hidden")}),
t=t.slice(0,b),0===t.length?(n.find(".appraisal-choose-label").css("visibility","hidden"),n.find(".appraisal-wrapper").css("visibility","hidden")):(1===t.length?(n=n.find(".adjusted-pricing-single"),n.find("#adjustedPriceLow").html(h.formatCurrency(t[0]))):(n=3<t.length?n.find(".adjusted-pricing-range"):n.find(".adjusted-pricing-double"),n.find("#adjustedPriceLow").html(h.formatCurrency(t[0])),n.find("#adjustedPriceHigh").html(h.formatCurrency(t[t.length-1]))),n.removeClass("aok-hidden")))},loadingSpinnerShow:function(){this.loadingSpinner.addClass("active")},
loadingSpinnerHide:function(){this.loadingSpinner.removeClass("active")},showAlert:function(a,d){this.tradeInWrapper.find(this.navCurrentView+" .alert-wrapper").html("").append(c("#alertTemplates "+a).clone()).addClass("active")},hideAlert:function(){this.tradeInWrapper.find(this.navCurrentView+" .alert-wrapper").html("").removeClass("active")},recordRefTag:function(a){a=this.tradeInRefTagUrl+this.tradeInRefTagPrefix+a;var c=a+"_"+this.tradeInProductGroup;this.doRecordRefTag(a);this.doRecordRefTag(c)},
doRecordRefTag:function(a){l.get(a,{error:function(a,b,c){h.recordError(b+"::"+c,"Error encountered during refTag record request")}})},spliceItemFromList:function(a,d){c.each(d,function(c,f){if(f.asin===a.asin)return d.splice(c,1),!1})},updateSelectedCountValueHeader:function(){0<this.promosApplied.length&&c.each(this.promosApplied,c.proxy(function(a,c){if(c.productGroup===this.tradeInProductGroup&&c.applied)return this.tradeInWrapper.find(".promo-text").hide(),this.tradeInWrapper.find(".promoText").hide(),
this.tradeInWrapper.find(".non-promo-text").show(),!1},this))},validateMaxSelectedItems:function(){this.selectedEligibleItems.length===a.maximumTradeInItemsCount?(this.toggleAllEligibleItemsSelectableState(!1),this.hasMaxItemsSelected=!0):(this.hideAlert(),this.hasMaxItemsSelected&&(this.toggleAllEligibleItemsSelectableState(!0),this.hasMaxItemsSelected=!1))},validateMaxGiftCardAmount:function(a){(a=this.getTradeInTotalValue()+a.tradeInValue>this.config.maxGiftCardAmount)||this.hideAlert();return a},
updateConditionViewHeaderCount:function(b,c){b.find(a.currentSelectedItemIndexId).html(c);b.find(a.selectedItemTotalCountId).html(this.selectedEligibleItems.length)},updateCsrfTokenByKey:function(b,c){c.hasOwnProperty(b)&&this.config.hasOwnProperty(a.csrfKeyMap)&&(this.config[a.csrfKeyMap][b]=c[b])},updateLaunchButtonText:function(){l.declarative.remove(c("#tradeInLaunchAction"),"launch-tanooki");var a=c(".tradein-instant-savings-launch-button"),d="#successfulNonIpButtonText";this.instantPaymentEligible&&
(d=this.promotionEligible?"#successfulIpWithPromotionButtonText":"#successfulIpNoPromotionButtonText");c.each(a,function(){var a=c(".tradein-templates "+d).clone();c(this).replaceWith(a)});a=c(".tradein-price-block");c.each(a,function(){var a=c(".tradein-templates "+d).clone();c(this).replaceWith(a)})}})});"use strict";u.when("A","a-modal","a-popover","trade-in-constants","trade-in-common-utils","trade-in-data-binder","trade-in-base-controller","ready").register("trade-in-controller",function(l,m,
k,a,h,d,f){function v(b){-1<b.indexOf(a.refTagPriceBlockPrefix)&&h.setRefTagPrefix(a.refTagPriceBlockPrefix);var d=a.tradeInRouteBase+"recordRefTag?deviceType\x3d"+h.getDeviceType()+"\x26ref_\x3d",f=h.getIngressButtonRefTag();h.recordRefTag(f,d,a.refTagButtonExperimentPreFix,h.getProductGroup());(d=h.getProductGroup())?(b=b+"_"+d,b=a.tradeInRouteBase+"getCustomerItems?deviceType\x3d"+h.getDeviceType()+"\x26productGroup\x3d"+d+"\x26ref_\x3d"+b):b=a.tradeInRouteBase+"generalerror?ref_\x3d"+(b+"_pg_missing");
(d=m.get(a.tradeInModalName))||(d=m.create(c("\x3cdiv /\x3e"),{url:b,name:a.tradeInModalName,header:h.getModalTitle(),width:700,cache:!1,padding:"none"}));d.show()}var c=l.$;h.captureTradeInContext();try{r.sessionStorage&&(sessionStorage.getItem(a.tanookiSessionStorageKey)&&(v(a.refTagPrefix+"auth_launch"),sessionStorage.removeItem(a.tanookiSessionStorageKey)),sessionStorage.getItem(a.priceBlockSessionStorageKey)&&(v(a.refTagPriceBlockPrefix+"auth_launch"),sessionStorage.removeItem(a.priceBlockSessionStorageKey)))}catch(b){r.ueLogError&&
r.ueLogError({message:b,logLevel:"ERROR",attribution:"tradein: session storage access blocked"})}l.declarative("launch-tanooki","click",function(b){var c=a.refTagPrefix,d=a.tanookiBuyboxMetric;b.data.ingressType===a.priceBlockIngressType&&(c=a.refTagPriceBlockPrefix,d=a.tanookiPriceblockMetric);h.setRefTagPrefix(c);v(c+"launch");h.recordMetric(d)});l.declarative("redirect-to-login","click",function(b){var c=h.getAuthPortalHandleFromHostname(),d=a.tanookiSessionStorageKey;b.data.ingressType===a.priceBlockIngressType&&
(d=a.priceBlockSessionStorageKey);h.redirectToAuth(c,d)});return f.extend({deviceType:h.getDeviceType(),authPortalAssocHandle:a.authPortalAssocHandle,searchInputClass:a.searchInputClass,alertMaxGCValueWarningClass:a.alertMaxGCValueWarningClass,alertMaxItemsWarningClass:a.alertMaxItemsWarningClass,alertItemAcceptableClass:a.alertItemAcceptableClass,init:function(){this.setConstants(a.tradeInModalName,h.getProductGroup(),h.getRefTagPrefix())},bindEvents:function(){this._super();l.declarative("edit-return-address",
"click",c.proxy(this.createReturnAddressPopover,this));l.declarative("return-to-shopping","click",c.proxy(function(){this.recordRefTag(a.refTagReturnToShopping);m.get(a.tradeInModalName).hide()},this));l.on("a:expander:weWantYouToKnow:toggle:expand",c.proxy(function(b){b=a.refTagWeWantYouToKnow;this.recordRefTag(b);this.instantPaymentMixed&&(b+="_mb");b+=this.tradeInReviewData.instantPaymentEligible?"_ip":"_nip";b+=this.tradeInReviewData.promotionEligible?"_p":"_np";this.recordRefTag(b)},this))},
getElements:function(){this.base=c(".a-popover-modal").filter(":visible");this._super()},createEligibleListView:function(){this._super();setTimeout(c.proxy(function(){this.tradeInWrapper.css("height","auto")},this),25)},createConfirmationView:function(){if(!this.tradeInReviewData.promotionEligible&&this.config.hasOwnProperty("deviceTradeInFlavor")&&"promo_only"===this.config.deviceTradeInFlavor){var a=d.bindDataToTemplate(c("#promoOnlyValidationErrorView"));this.tradeInWrapper.append(a)}else this._super(),
a=this.tradeInWrapper.find(".tradein-selected-items-confirmation-view"),a.find("#weWantYouToKnow a.a-link-expander").click(),this.instantPaymentMixed||a.find(this.instantPaymentEligible?".ip-eligible":".nip-eligible").show()},createReturnAddressPopover:function(){this.recordRefTag(a.refTagReturnAddressUpdateView);k.create(this.tradeInWrapper.find(".know-list:visible #editReturnAddress"),{name:"returnAddressUpdate",dataStrategy:"inline",inlineContent:c("#returnAddressPopoverTemplate").html(),width:400,
position:"triggerTop",activate:"onclick"}).show();var b=c(".a-popover.a-declarative.a-arrow-top:visible .tradein-popover-address-container");this.createReturnAddressInstance(b)},createNearbyProcessorExpander:function(){this.recordRefTag(a.refTagNearbyProcessorsDesktop);var b=this.dropOffLocationExpander.find("#dropOffLocationListExpanderTemplate"),c=b.find("#dropOffLocationListExpander"),d=this.tradeInReviewData.defaultReturnAddress.line1+" - "+this.tradeInReviewData.defaultReturnAddress.city+" "+
this.tradeInReviewData.defaultReturnAddress.postalCode;b.find(".customerAddress").html(d);h.createNearbyProcessorsList(this.offlineDropOffLocations,c,b)},handleReturnAddressChange:function(a){a=c(a.currentTarget);k.get("returnAddressUpdate").hide();this._super(a)},updateSelectedCountValueHeader:function(){var a=this.selectedEligibleItems.length;if(0===a)this.tradeInWrapper.find(".select-header.promo-text").show(),this.tradeInWrapper.find(".count-value-header").hide();else{this.tradeInWrapper.find(".select-header.promo-text").hide();
var c=this.tradeInWrapper.find(".count-value-header");c.find("#selectedItemTotalCount").html(a);c.find("#tradeInTotalValue").html(h.formatCurrency(this.getTradeInTotalValue()));c.show()}this._super()}})});"use strict";u.when("A","trade-in-controller","ready").register("trade-in-controller-factory",function(l,m){return{ctrlInstance:null,getInstance:function(){this.ctrlInstance||(this.ctrlInstance=new m);return this.ctrlInstance}}});var w=function(){return function(l){function m(a,c){return a.classList?
a.classList.contains(c):(new RegExp("\\b"+c+"\\b")).test(a.className)}function k(a,c,b){a.attachEvent?a.attachEvent("on"+c,b):a.addEventListener(c,b)}function a(a,c,b){a.detachEvent?a.detachEvent("on"+c,b):a.removeEventListener(c,b)}function h(a,c,b,d){k(d||document,c,function(c){for(var t,d=c.target||c.srcElement;d&&!(t=m(d,a));)d=d.parentElement;t&&b.call(d,c)})}if(document.querySelector){var d={selector:0,source:0,minChars:3,delay:150,offsetLeft:0,offsetTop:1,cache:1,menuClass:"",renderItem:function(a,
c){c=c.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$\x26");c=new RegExp("("+c.split(" ").join("|")+")","gi");return'\x3cdiv class\x3d"autocomplete-suggestion" data-val\x3d"'+a+'"\x3e'+a.replace(c,"\x3cb\x3e$1\x3c/b\x3e")+"\x3c/div\x3e"},onSelect:function(){}},f;for(f in l)l.hasOwnProperty(f)&&(d[f]=l[f]);var v="object"==typeof d.selector?[d.selector]:document.querySelectorAll(d.selector);for(l=0;l<v.length;l++){var c=v[l];c.sc=document.createElement("div");c.sc.className="autocomplete-suggestions "+d.menuClass;
c.autocompleteAttr=c.getAttribute("autocomplete");c.setAttribute("autocomplete","off");c.cache={};c.last_val="";c.updateSC=function(a,b){var f=c.getBoundingClientRect();if(c.sc.style.left=Math.round(f.left+(r.pageXOffset||document.documentElement.scrollLeft)+d.offsetLeft)+"px",c.sc.style.top=Math.round(f.bottom+(r.pageYOffset||document.documentElement.scrollTop)+d.offsetTop)+"px",c.sc.style.width=Math.round(f.right-f.left)+"px",!a&&(c.sc.style.display="block",c.sc.maxHeight||(c.sc.maxHeight=parseInt((r.getComputedStyle?
getComputedStyle(c.sc,null):c.sc.currentStyle).maxHeight)),c.sc.suggestionHeight||(c.sc.suggestionHeight=c.sc.querySelector(".autocomplete-suggestion").offsetHeight),c.sc.suggestionHeight))b?(a=c.sc.scrollTop,b=b.getBoundingClientRect().top-c.sc.getBoundingClientRect().top,0<b+c.sc.suggestionHeight-c.sc.maxHeight?c.sc.scrollTop=b+c.sc.suggestionHeight+a-c.sc.maxHeight:0>b&&(c.sc.scrollTop=b+a)):c.sc.scrollTop=0};k(r,"resize",c.updateSC);document.body.appendChild(c.sc);h("autocomplete-suggestion",
"mouseleave",function(){var a=c.sc.querySelector(".autocomplete-suggestion.selected");a&&setTimeout(function(){a.className=a.className.replace("selected","")},20)},c.sc);h("autocomplete-suggestion","mouseover",function(){var a=c.sc.querySelector(".autocomplete-suggestion.selected");a&&(a.className=a.className.replace("selected",""));this.className+=" selected"},c.sc);h("autocomplete-suggestion","mousedown",function(a){if(m(this,"autocomplete-suggestion")){var b=this.getAttribute("data-val");c.value=
b;d.onSelect(a,b,this);c.sc.style.display="none"}},c.sc);c.blurHandler=function(){try{var a=document.querySelector(".autocomplete-suggestions:hover")}catch(b){a=0}a?c!==document.activeElement&&setTimeout(function(){c.focus()},20):(c.last_val=c.value,c.sc.style.display="none",setTimeout(function(){c.sc.style.display="none"},350))};k(c,"blur",c.blurHandler);var b=function(a){var b=c.value;if(c.cache[b]=a,a.length&&b.length>=d.minChars){for(var f="",e=0;e<a.length;e++)f+=d.renderItem(a[e],b);c.sc.innerHTML=
f;c.updateSC(0)}else c.sc.style.display="none"};c.keydownHandler=function(a){var b=r.event?a.keyCode:a.which;if((40==b||38==b)&&c.sc.innerHTML){var f,e=c.sc.querySelector(".autocomplete-suggestion.selected");return e?(f=40==b?e.nextSibling:e.previousSibling,f?(e.className=e.className.replace("selected",""),f.className+=" selected",c.value=f.getAttribute("data-val")):(e.className=e.className.replace("selected",""),c.value=c.last_val,f=0)):(f=40==b?c.sc.querySelector(".autocomplete-suggestion"):c.sc.childNodes[c.sc.childNodes.length-
1],f.className+=" selected",c.value=f.getAttribute("data-val")),c.updateSC(0,f),!1}27==b?(c.value=c.last_val,c.sc.style.display="none"):(13==b||9==b)&&(e=c.sc.querySelector(".autocomplete-suggestion.selected"))&&"none"!=c.sc.style.display&&(d.onSelect(a,e.getAttribute("data-val"),e),setTimeout(function(){c.sc.style.display="none"},20))};k(c,"keydown",c.keydownHandler);c.keyupHandler=function(a){a=r.event?a.keyCode:a.which;if(!a||(35>a||40<a)&&13!=a&&27!=a){var f=c.value;if(f.length>=d.minChars){if(f!=
c.last_val){if(c.last_val=f,clearTimeout(c.timer),d.cache){if(f in c.cache)return void b(c.cache[f]);for(a=1;a<f.length-d.minChars;a++){var h=f.slice(0,f.length-a);if(h in c.cache&&!c.cache[h].length)return void b([])}}c.timer=setTimeout(function(){d.source(f,b)},d.delay)}}else c.last_val=f,c.sc.style.display="none"}};k(c,"keyup",c.keyupHandler);c.focusHandler=function(a){c.last_val="\n";c.keyupHandler(a)};d.minChars||k(c,"focus",c.focusHandler)}this.destroy=function(){for(var b=0;b<v.length;b++){var c=
v[b];a(r,"resize",c.updateSC);a(c,"blur",c.blurHandler);a(c,"focus",c.focusHandler);a(c,"keydown",c.keydownHandler);a(c,"keyup",c.keyupHandler);c.autocompleteAttr?c.setAttribute("autocomplete",c.autocompleteAttr):c.removeAttribute("autocomplete");document.body.removeChild(c.sc)}}}}}();!function(){"function"==typeof define&&define.amd?define("autoComplete",function(){return w}):"undefined"!=typeof module&&module.exports?module.exports=w:r.autoComplete=w}();"use strict";u.when("A","ready").register("tradein-desktop-side-sheet",
function(l){var m,k=l.$,a,h,d;return{initialize:function(){a=k("\x3cdiv id\x3d'a-popover-lgtbox' class\x3d'a-declarative attach-popover tradein-lgtbox' data-action\x3d'a-popover-floating-close'\x3e\x3c/div\x3e");a.hide();a.appendTo(document.body);a.click(this.close);d=k('\x3cdiv id\x3d"tradein-desktop-side-sheet" class\x3d"a-section"\x3e\x3c/div\x3e');d.addClass("aok-hidden");k('\x3cdiv class\x3d"a-spinner-wrapper sidesheet-spinner"\x3e\x3cspan class\x3d"a-spinner a-spinner-medium"\x3e\x3c/span\x3e\x3c/div\x3e').appendTo(d);
d.appendTo(document.body);k(document).unbind("keydown",this.onKeyDown);k(document).keydown(this.onKeyDown);m=this.close},onKeyDown:function(a){27===a.which&&m()},close:function(){l.trigger("tanooki-trade-in-desktop-side-sheet-close");a.hide();k(d).animate({right:h},{duration:500,complete:function(){k(d).remove();k(a).remove();k("body").removeClass("scroll-disabled")}})},show:function(f,l){k(d).removeClass("aok-hidden");k(d).animate({right:"0"},500,"linear");k(d).find(".sidesheet-spinner").addClass("active");
a.show();k.when(f).done(function(a){k(d).find(".sidesheet-spinner").remove("active");k("#tradein-desktop-side-sheet").html(a);l&&"function"===typeof l&&l()});h=k(d).css("right")}}});"use strict";u.when("A","a-popover","trade-in-constants","trade-in-common-utils","trade-in-data-binder","trade-in-asin-category-selection-base-controller","tradein-desktop-side-sheet","tanooki-offline","ready").register("trade-in-wireless-asin-category-selection-controller",function(l,m,k,a,h,d,f,v){function c(c){var b=
a.getIngressButtonRefTag();a.recordTv2RefTag(b,e);c=k.refTagTv2+c;var d=a.getProductGroup(),h=a.getCurrentAsin();d?(b=c+"_"+d,b={deviceType:a.getDeviceType(),productGroup:d,ref_:b,currentAsin:h},b=g.param(b),b=k.tradeInRouteBase+"wirelessTradeInSearchRefinements?"+b):b=k.tradeInRouteBase+"generalerror?ref_\x3d"+(c+"_pg_missing");p=g.get(b);f.initialize();g("body").addClass("scroll-disabled");f.show(p,function(){n=!0;0<g("#tradein-desktop-side-sheet").find(".tradein-logged-out-view").length?a.recordTv2RefTag(k.refTagAuthRequired,
e):0<=c.indexOf("auth_launch")&&a.recordTv2RefTag(k.refTagAuthCompleted,e)})}function b(){n||a.recordTv2RefTag(k.refTagAuthRequired,e);var c=a.getAuthPortalHandleFromHostname();a.redirectToAuth(c,"launchAsinCategoryTradeIn");a.setStorefrontSessionStorage(q)}var g=l.$,p,q=!1,e=k.tradeInRouteBase+"recordRefTag?deviceType\x3d"+a.getDeviceType()+"\x26ref_\x3d",n=!1;a.captureTradeInContext();q=a.getStorefrontSessionStorage();a.shouldLaunchTanookiV2OnPageLoad()&&c("auth_launch");l.declarative("launch-tanooki-wireless",
"click",function(){c("launch")});l.declarative("launch-tanooki-v2","click",function(){c("launch")});l.declarative("launch-tanooki-v2-storefront","click",function(b){q=!0;a.updateTradeInContext(b.data);c("launch")});l.declarative("redirect-to-login-wireless","click",function(){b()});l.declarative("redirect-to-login-v2","click",function(){b()});return d.extend({deviceType:a.getDeviceType(),authPortalAssocHandle:k.authPortalAssocHandle,init:function(){this.setConstants(k.tradeInSideSheetName,a.getProductGroup(),
q)},bindEvents:function(){this._super();this.tradeInWrapper.delegate(".exit-sidesheet-button","click",g.proxy(function(){f.close()},this));this.tradeInWrapper.delegate(".return-to-shopping, #returnToShopping","click",g.proxy(function(){f.close()},this));l.off("tanooki-trade-in-desktop-side-sheet-close");l.on("tanooki-trade-in-desktop-side-sheet-close",g.proxy(function(){a.recordTv2RefTag(k.refTagExit+this.getCurrentViewForRefTag(),this.tradeInRefTagUrl,this.bifurcationRefTags)},this))},getElements:function(){this.base=
g("#tradein-desktop-side-sheet");this._super()},createReturnAddressPopover:function(){a.recordTv2RefTag(k.refTagReturnAddressUpdateView,this.tradeInRefTagUrl,this.bifurcationRefTags);m.create(this.tradeInWrapper.find("#editReturnAddress"),{name:"returnAddressUpdate",dataStrategy:"inline",inlineContent:g("#returnAddressPopoverTemplate").html(),width:400,position:"triggerTop",activate:"onclick"}).show();g(".a-popover").addClass("popover-content-overlay");var c=g(".a-popover.a-declarative.a-arrow-top:visible .tradein-popover-address-container");
this.createReturnAddressInstance(c)},createPromotionInformationPanel:function(){a.recordTv2RefTag(k.refTagPromotionInformationPopoverView,this.tradeInRefTagUrl,this.bifurcationRefTags);m.create(this.tradeInWrapper.find("#promotionInformationPopover"),{name:"promotionInformationPopover",dataStrategy:"inline",inlineContent:g("#promotionInformationPopoverTemplate").html(),width:400,position:"triggerBottom",activate:"onclick"}).show();g(".a-popover").addClass("popover-content-overlay")},createNearbyProcessorsPanel:function(){a.recordRefTag(k.refTagNearbyProcessorsDesktop,
e,k.refTagTv2,a.getProductGroup());var c=this.offlineDropOffLocations,b=this.dropOffLocationListTemplate,n=b.find("#dropOffLocationList"),d=this.tradeInReviewData.defaultReturnAddress.line1+" - "+this.tradeInReviewData.defaultReturnAddress.city+" "+this.tradeInReviewData.defaultReturnAddress.postalCode;b.find(".customerAddress").html(d);a.createNearbyProcessorsList(c,n,b);m.create(this.tradeInWrapper.find("#dropOffLocations"),{name:"nearbyProcessorLocationsPopover",dataStrategy:"inline",inlineContent:g("#dropOffLocationListTemplate").html(),
width:400,position:"triggerTop",activate:"onclick"}).show();g(".a-popover").addClass("popover-content-overlay")},createAppraisalLearnMorePanel:function(){a.recordTv2RefTag(k.refTagAppraisalLearnMorePopoverView,this.tradeInRefTagUrl,this.bifurcationRefTags);var c=m.create(this.tradeInWrapper.find("#appraisalLearnMore"),{name:"appraisalLearnMorePopover",dataStrategy:"inline",inlineContent:g("#appraisalLearnMorePopoverTemplate").html(),width:400,position:"triggerTop",activate:"onclick"});k.tradeInEchoGl===
this.tradeInProductGroup&&g("#appraisalLearnMorePopoverTemplate").find(".echo-learn-more-link").removeClass("aok-hidden");c.show();g(".a-popover").addClass("popover-content-overlay")},createRegisteredDevicesLearnMorePanel:function(){a.recordTv2RefTag(k.refTagRegisteredDevicesLearnMorePopoverView,this.tradeInRefTagUrl,this.bifurcationRefTags);m.create(this.tradeInWrapper.find("#registeredDevicesLearnMore"),{name:"registeredDevicesLearnMorePopover",dataStrategy:"inline",inlineContent:g("#registeredDevicesLearnMorePopoverTemplate").html(),
width:400,position:"triggerBottom",activate:"onclick"}).show();g(".a-popover").addClass("popover-content-overlay")},createAsinDetailsView:function(a){a=g(a.currentTarget);var c=a.data("asinDetailsData");if(c){var b=h.bindDataToAsinSelectionTemplate(this.asinDetailsViewTemplate,c);if(c.hasOwnProperty("isEnabled")&&!c.isEnabled){var c=b.find(".tiv-estimate-container"),n=c.find(".unavailable-offer");g(n).removeClass("aok-hidden");g(c).html(n)}var b={name:"asinDetailsView",inlineContent:b,width:500,position:"triggerHorizontal",
activate:"onclick"},d=m.create(this.tradeInWrapper.find(a),b);d.show();g(".a-popover").addClass("popover-content-overlay");l.on("a:popover:afterShow",function(){g(".a-scroller").addClass("scroll-disabled")});l.on("a:popover:afterHide",function(){g(".a-scroller").removeClass("scroll-disabled")});l.on("tanooki-trade-in-desktop-side-sheet-close",function(){d.hide()})}},createVerticalCardViewComponentWithTradeInTotalContent:function(c,b,n){try{var d=this.getSanitizedItemListFromReviewData();if(this.searchTradeInImageIndicator&&
0<d.length){var e={imageUrl:this.searchTradeInImageIndicator,maxTiv:b};e[c]="classType";var f=h.bindDataToAsinSelectionTemplate(this.verticalComplexCardViewTemplate,e),k=f.find("#tradeinTotalWithOfferDetailsComponent");d[0].instantPayable?(k.find(".ip").html(a.formatCurrency(b)),k.find(".instant-payable").removeClass("aok-hidden")):(k.find(".not-instant-payable").html(a.formatCurrency(b)),k.find(".not-instant-payable").removeClass("aok-hidden"))}else a.recordError("Required data for vertical card view unavailable",
"Error encountered hitting search refinement request");var l=f.find("#tradeinEstimateOfferComponent .selection-history-list"),m=this.categoryRefinementSelectionItemComponent;0<this.config.translatedSelectionHistory.length?(this.translatedSelectionHistory=this.config.translatedSelectionHistory,this.config.translatedSelectionHistory.forEach(function(a){a=h.bindDataToAsinSelectionTemplate(m,{selectionItem:a});g(l).append(a)})):0<this.config.restrictionHistory.length?(this.restrictionHistory=this.config.restrictionHistory,
this.config.restrictionHistory.forEach(function(a){a=h.bindDataToAsinSelectionTemplate(m,{selectionItem:a.emittedData});g(l).append(a)})):f.find(".vertical-card-tradein-details").addClass("aok-hidden");var p=d.some(function(a){if(a.asin===n)return a.instantPayable});this.config.finalSearchResult&&f.find("#itemTitle").html(a.generatePrettyTitle(this.config.finalSearchResult.asinTitle));a.isGlEligibleForPastPurchases(this.tradeInProductGroup)&&g.each(this.pastPurchasedEligibleItems,function(c,b){n===
b.asin&&f.find("#itemTitle").html(a.generatePrettyTitle(b.title))});if(p){var q=f.find("#ipOfferAmount");g(q).removeClass("aok-hidden");var v=this.tradeInReviewData.orderTotalPaidInstantly,r=g(q).find(".price").first();g(r).html(a.formatCurrency(v))}else{q=f.find("#nonIpOfferAmount");g(q).removeClass("aok-hidden");var u=this.tradeInReviewData.orderTotalPaidOnGrading,w=g(q).find(".price").first();g(w).html(a.formatCurrency(u))}}catch(A){throw"[Error at createVerticalCardViewComponentWithTradeInTotalContent]"+
A;}return f}})});"use strict";u.when("A","trade-in-wireless-asin-category-selection-controller","ready").register("trade-in-asin-category-selection-controller-factory",function(l,m){return{ctrlInstance:null,getInstance:function(){this.ctrlInstance||(this.ctrlInstance=new m);return this.ctrlInstance}}});"use strict";u.when("A","a-popover","a-button","trade-in-constants","trade-in-common-base","trade-in-common-utils","trade-in-data-binder","tradein-show-promotion-expander","trade-in-cc-constants","trade-in-cc-expander",
"trade-in-cc-card-wireless-gl-gate","trade-in-cc-card-wireless-gl-gate-mobile","tanooki-offline","ready").register("trade-in-asin-category-selection-base-controller",function(l,m,k,a,h,d,f,v,c,b,g,p,q){var e=l.$;return h.extend({config:null,deviceType:null,authPortalAssocHandle:null,navViews:null,navCurrentView:null,tradeInWrapper:null,loadingSpinner:null,tradeInViewInstanceName:null,tradeInSaveGradedItemConditionUrl:null,tradeInReviewUrl:null,tradeInSubmitUrl:null,tradeInRefTagUrl:null,tradeInRemoveItemUrl:null,
tradeInRefTagPrefix:null,bifurcationRefTags:[],tradeInProductGroup:null,restrictionSelectionPage:[],priceHistory:[],showVerticalImageCardView:!1,searchTradeInImageIndicator:null,finalSearchResults:null,changeConditionData:null,conditionSelectionMap:null,isChangeConditionContext:!1,estimatedMaxTiv:0,expectedPages:0,hasPendingRequest:!1,tradeInReviewData:null,promotionEligible:!1,selectionInProgress:!1,isProcessing:!1,invalidReturnAddress:!1,isStorefront:!1,isLowestAppraisal:!1,tradeInSearchCurrentState:{term:""},
searchPageSize:0,searchOffersOnly:!0,pastPurchasedEligibleItems:[],questionnaires:[],restrictionHistory:[],translatedSelectionHistory:[],previousView:null,currentAsin:[],promoData:null,showOfflineOption:!1,offlineDropOffLocations:[],tradeInCartQuantity:0,tradeInCartTiv:0,conditionViewTemplate:null,tradeinHeaderViewTemplate:null,tradeInPromoPreviewViewTemplate:null,tradeinCartHeaderTemplate:null,tradeinCartSubmitViewHeaderTemplate:null,verticalComplexCardViewTemplate:null,appraisalSelectionComponentView:null,
termsAndAgreementViewTemplate:null,multiItemTermsAndAgreementViewTemplate:null,multiItemTermsAndAgreementViewTemplateDevices:null,tradeinReviewYourOrderNextStepTemplate:null,mixedOfferNextStepsTemplate:null,multiItemConfirmationOrderDetailsViewComponent:null,tradeinFooterComponent:null,successfulTradeInBannerComponentView:null,tradeInSubmitConditionButtonTemplate:null,binaryQuestionnaireListViewTemplate:null,shipmentDetailViewComponent:null,dropOffLocationsTemplate:null,dropOffBannerNoLinkComponent:null,
dropOffLocationListTemplate:null,offlineMessageSection:null,searchRefinementItemSelectionTemplate:null,refinementSearchViewTemplate:null,categoryRefinementSelectionItemComponent:null,tradeinCartItemComponent:null,shipmentDetailsHeaderComponent:null,tradeinSubmitButtonComponent:null,tradeinSubmitWrapperComponent:null,tradeinCartTemplate:null,customerPastDevicesPurchasesCarouselContainerTemplate:null,pastPurchasedListViewTemplate:null,customerIpPreferenceComponent:null,customerIpPreference:null,load:function(){this.config=
l.state("tradeInConfig");this.pastPurchasedEligibleItems=this.config.eligibleItems;this.questionnaires=this.config.questionnaires;d.setLocale(this.config.locale);d.setCurrencyCode(this.config.currencyCode);f.setCommonUtils(d);this.navViews={refinementSelectionView:a.refinementSelectionViewWrapperClass,refinementSearchView:a.refinementSearchViewClass,tradeInConditionView:a.conditionViewTemplateId,submitTradeInView:a.submitTradeInWrapperClass,tradeInCartView:a.tradeInCartViewClass,restrictionSearchTradeInNextStepView:a.tradeinReviewYourOrderNextStepTemplateId};
this.init();this.getElements();this.bindEvents();this.cleanState();this.navCurrentView=this.navViews.refinementSelectionView;this.updateCartHeaderData();this.createView();this.restrictionSelectionPage.push(this.navCurrentView)},setConstants:function(c,b,e){this.tradeInRefTagPrefix=a.refTagTv2;this.tradeInViewInstanceName=c;this.tradeInProductGroup=b;this.tradeInSubmitUrl=a.tradeInRouteBase+"confirmTradeInOrder?deviceType\x3d"+this.deviceType+"\x26ref_\x3d"+this.tradeInRefTagPrefix+"submit_request_"+
b;this.tradeInSaveGradedItemConditionUrl=a.tradeInRouteBase+"addToTradeIn";this.tradeInRefTagUrl=a.tradeInRouteBase+"recordRefTag?deviceType\x3d"+this.deviceType+"\x26ref_\x3d";this.tradeInReviewUrl=a.tradeInRouteBase+"reviewTradeInOrder?deviceType\x3d"+this.deviceType+"\x26productGroup\x3d"+b+"\x26ref_\x3d"+this.tradeInRefTagPrefix+"review_request_"+b;this.tradeInSearchCategoryRefinementUrl=a.tradeInRouteBase+"searchRestrictionItems?deviceType\x3d"+this.deviceType+"\x26ref_\x3d"+this.tradeInRefTagPrefix+
"\x26productGroup\x3d"+b;this.tradeInGetSelfGradingQuestionnaireUrl=a.tradeInRouteBase+"getSelfGradingQuestionnaire?deviceType\x3d"+this.deviceType+"\x26ref_\x3d"+this.tradeInRefTagPrefix+"\x26productGroup\x3d"+b;this.tradeInRemoveItemUrl=a.tradeInRouteBase+"removeItem?deviceType\x3d"+this.deviceType+"\x26ref_\x3d"+this.tradeInRefTagPrefix+"remove_item_request_"+b;this.isStorefront=e;this.searchPageSize=d.getTanookiV2SearchPageSize(this.deviceType)},getElements:function(){this.tradeInWrapper=this.base.find(a.tradeInWrapperClass);
this.conditionViewTemplate=this.base.find(a.conditionViewTemplateId);this.tradeinHeaderViewTemplate=this.base.find(a.tradeinHeaderViewTemplateId);this.tradeinCartHeaderTemplate=this.base.find(a.tradeinCartHeaderTemplateId);this.tradeinCartSubmitViewHeaderTemplate=this.base.find(a.tradeinCartSubmitViewHeaderTemplateId);this.tradeInCartPromosTemplate=this.base.find(a.tradeInCartPromosTemplateId);this.tradeInPromoPreviewViewTemplate=this.base.find(a.tradeInPromoPreviewViewTemplate);this.verticalComplexCardViewTemplate=
this.base.find(a.verticalComplexCardViewTemplateId);this.appraisalSelectionComponentView=this.base.find(a.appraisalSelectionComponentViewId);this.promotionInformationComponent=this.base.find(a.promotionInformationComponentId);this.termsAndAgreementViewTemplate=this.base.find(a.termsAndAgreementViewTemplateId);this.multiItemTermsAndAgreementViewTemplate=this.base.find(a.multiItemTermsAndAgreementViewTemplateId);this.multiItemTermsAndAgreementViewTemplateDevices=this.base.find(a.multiItemTermsAndAgreementViewTemplateDevicesId);
this.tradeinReviewYourOrderNextStepTemplate=this.base.find(a.tradeinReviewYourOrderNextStepTemplateId);this.mixedOfferNextStepsTemplate=this.base.find(a.mixedOfferNextStepsTemplateId);this.multiItemConfirmationOrderDetailsViewComponent=this.base.find(a.multiItemConfirmationOrderDetailsViewComponentClass);this.tradeinFooterComponent=this.base.find(a.tradeinFooterComponentId);this.successfulTradeInBannerComponentView=this.base.find(a.successfulTradeInBannerComponentViewId);this.tradeInSubmitConditionButtonTemplate=
this.base.find(a.tradeInSubmitConditionButtonTemplateId);this.binaryQuestionnaireListViewTemplate=this.base.find(a.binaryQuestionnaireListViewTemplateId);this.shipmentDetailViewComponent=this.base.find(a.shipmentDetailViewComponentId);this.dropOffLocationsTemplate=this.base.find(a.dropOffLocationsTemplateId);this.dropOffBannerNoLinkComponent=this.base.find(a.dropOffBannerNoLinkComponentId);this.dropOffLocationListTemplate=this.base.find(a.dropOffLocationListTemplateId);this.offlineMessageSection=
this.base.find(a.offlineMessageSectionClass);this.searchRefinementItemSelectionTemplate=this.base.find(a.searchRefinementItemSelectionTemplateId);this.refinementSearchViewTemplate=this.base.find(a.refinementSearchViewTemplateId);this.categoryRefinementSelectionItemComponent=this.base.find(a.categoryRefinementSelectionItemComponentId);this.tradeinCartItemComponent=this.base.find(a.tradeinCartItemComponentId);this.shipmentDetailsHeaderComponent=this.base.find(a.shipmentDetailsHeaderComponentClass);
this.tradeinSubmitButtonComponent=this.base.find(a.tradeinSubmitButtonComponentClass);this.tradeinSubmitWrapperComponent=this.base.find(a.tradeinSubmitWrapperComponentId);this.tradeInCartTemplate=this.base.find(a.tradeInCartTemplateId);this.customerPastDevicesPurchasesCarouselContainerTemplate=this.base.find(a.customerPastDevicesPurchasesCarouselContainerId);this.pastPurchasedListViewTemplate=this.base.find(a.pastPurchasedListViewTemplateId);this.asinDetailsViewTemplate=this.base.find(a.asinDetailsViewTemplateId);
this.customerIpPreferenceComponent=this.base.find(a.customerIpPreferenceComponentId);this.loadingSpinner=this.base.find(a.loadingSideSheetSpinnerClass);this.base.find(a.tradeInMoreItemsButtonContainerClass).removeClass("aok-hidden")},bindEvents:function(){this.tradeInWrapper.delegate(".previous-button","click",e.proxy(this.handlePreviousButton,this));this.tradeInWrapper.delegate(".navigate-to-cart-button","click",e.proxy(this.handleNavigateToCart,this));this.tradeInWrapper.delegate(".print-shipping-label-container #printLabelButton",
"click",e.proxy(this.handlePrintShippingLabel,this));this.tradeInWrapper.delegate(".error-alert-continue-button","click",e.proxy(this.handleNavigateToCart,this));this.tradeInWrapper.delegate(".non-tradeable-error-alert-continue-button","click",e.proxy(this.handleTradeInMoreItems,this));this.tradeInWrapper.delegate("#editReturnAddress","click",e.proxy(this.createReturnAddressPopover,this));this.tradeInWrapper.delegate("#promotionInformationPopover","click",e.proxy(this.createPromotionInformationPanel,
this));this.tradeInWrapper.delegate("#appraisalLearnMore","click",e.proxy(this.createAppraisalLearnMorePanel,this));this.tradeInWrapper.delegate("#registeredDevicesLearnMore","click",e.proxy(this.createRegisteredDevicesLearnMorePanel,this));this.tradeInWrapper.delegate("#dropOffLocations","click",e.proxy(this.createNearbyProcessorsPanel,this));this.tradeInWrapper.delegate(".adjusted-value-agreement-button","click",e.proxy(this.handleAdjustedValueAgreementButton,this));this.tradeInWrapper.delegate(".ip-preference-button",
"click",e.proxy(this.handleIpPreferenceButton,this));this.tradeInWrapper.delegate(".handle-submit-your-tradein","click",e.proxy(function(a){var b=e(a.currentTarget);k(a).isEnabled()&&!b.hasClass("a-button-disabled")&&this.handleTradeInSubmit()},this));this.tradeInWrapper.delegate(".handle-review-your-tradein","click",e.proxy(function(a){var b=e(a.currentTarget);k(a).isEnabled()&&!b.hasClass("a-button-disabled")&&this.handleNavigateToCart()},this));this.tradeInWrapper.delegate(".handle-trade-in-more-items",
"click",e.proxy(function(a){this.handleTradeInMoreItems()},this));this.tradeInWrapper.delegate(".agreement-checkbox","change",e.proxy(function(a){this.handleTermsAndAgreementCheckboxSelection(a)},this));this.tradeInWrapper.delegate(".continue-trigger","click",e.proxy(function(a){k(a).isEnabled()&&(this.isChangeConditionContext?this.handleChangeConditionComplete():this.handleContinueConditionButtonClick())},this));this.tradeInWrapper.delegate(a.conditionQuestionButtonSelectorClass,"click",e.proxy(function(a){var b=
e(a.currentTarget);k(b).isEnabled()&&!b.hasClass("a-button-unavailable")&&this.handleConditionSelection(a)},this));this.tradeInWrapper.delegate(".submit-refinement button","click",e.proxy(function(a){var b=e(a.currentTarget);k(b).isEnabled()&&!b.hasClass("a-button-unavailable")&&this.handleRefinementSubmit(a)},this));this.tradeInWrapper.delegate(".past-purchase-refinement","click",e.proxy(function(a){var b=e(a.currentTarget);k(b).isEnabled()&&!b.hasClass("a-button-unavailable")&&this.handlePastPurchaseRefinementSelect(a)},
this));this.tradeInWrapper.delegate(".refinement-search-form","submit",e.proxy(function(a){this.handleRefinementSearchFormSubmit(a)},this));this.tradeInWrapper.delegate("#loadMoreSearchResults","click",e.proxy(function(a){e(a.currentTarget).blur();this.handleLoadMoreSearchResults()},this));this.tradeInWrapper.delegate("#seeAllSearchResults","click",e.proxy(function(){this.searchOffersOnly=!1;this.handleRefinementSearchFormSubmit()},this));this.tradeInWrapper.delegate("#seeOnlyOffersSearchResults",
"click",e.proxy(function(){this.searchOffersOnly=!0;this.handleRefinementSearchFormSubmit()},this));this.tradeInWrapper.delegate(a.refinementSearchInputSelector,"focusin",e.proxy(function(){this.tradeInWrapper.find(".refinement-search-button").addClass("active")},this));this.tradeInWrapper.delegate(a.refinementSearchInputSelector,"focusout",e.proxy(function(){this.tradeInWrapper.find(".refinement-search-button").removeClass("active")},this));this.tradeInWrapper.delegate(".refinement-search-item-title",
"click",e.proxy(function(a){this.createAsinDetailsView(a)},this));this.tradeInWrapper.delegate(".tradein-cart-item a.remove-link","click",e.proxy(function(b){d.recordTv2RefTag(a.refTagRemoveCartItem,this.tradeInRefTagUrl,this.bifurcationRefTags);this.handleRemoveCartItem(b)},this));this.tradeInWrapper.delegate(".tradein-cart-item a.change-condition-link","click",e.proxy(function(b){d.recordTv2RefTag(a.refTagChangeCondition,this.tradeInRefTagUrl,this.bifurcationRefTags);this.handleNavigateToChangeCondition(b)},
this));this.tradeInWrapper.delegate("a.tradein-login","click",e.proxy(function(){var a=d.getAuthPortalHandleFromHostname();d.redirectToAuth(a,"launchAsinCategoryTradeIn")},this));this.tradeInWrapper.delegate("#submitTradeInButtonAgreementText","click",e.proxy(function(){d.recordTv2RefTag(a.refTagTermsAndConditions,this.tradeInRefTagUrl,this.bifurcationRefTags)},this));this.tradeInWrapper.delegate("a#howToLink","click",e.proxy(function(){d.recordTv2RefTag(a.refTagHowToLink+"_"+this.getCurrentRefinementTitleForRefTag(),
this.tradeInRefTagUrl,this.bifurcationRefTags)},this))},createView:function(){this.clearAllViews();switch(this.navCurrentView){case this.navViews.refinementSelectionView:this.recordViewRefTag();this.createRestrictionItemView();break;case this.navViews.refinementSearchView:this.recordViewRefTag();this.createRefinementSearchView();break;case this.navViews.tradeInConditionView:this.isChangeConditionContext?this.createTradeInChangeConditionView():(this.recordViewRefTag(),this.createTradeInConditionView());
break;case this.navViews.submitTradeInView:this.recordViewRefTag();this.createSubmitTradeInView();break;case this.navViews.tradeInCartView:this.recordViewRefTag();this.createTradeInCartView();break;case this.navViews.restrictionSearchTradeInNextStepView:this.createTradeInNextStepsView();break;default:this.createRestrictionItemView()}},createTradeInHeaderComponent:function(a){try{var b=f.bindDataToAsinSelectionTemplate(this.tradeinHeaderViewTemplate,{progressPercentage:Math.ceil(this.config.pageIndex/
this.expectedPages*100)+"%"});b.find(".back-button-container").removeClass("aok-hidden");a||b.find(".previous-button").addClass("aok-hidden")}catch(c){d.recordError(c,"Error occurred at createTradeInHeaderComponent")}return b},createTradeInCartHeaderComponent:function(b){try{var c=f.bindDataToAsinSelectionTemplate(b,{cartQuantity:this.tradeInCartQuantity,cartTiv:this.tradeInCartTiv});this.tradeInCartQuantity&&0!==this.tradeInCartQuantity?(c.removeClass("aok-hidden"),1===this.tradeInCartQuantity?(c.find(a.tradeinCartHeaderItemsSingularClass).removeClass("aok-hidden"),
c.find(a.tradeinCartHeaderItemsPluralClass).addClass("aok-hidden")):(c.find(a.tradeinCartHeaderItemsSingularClass).addClass("aok-hidden"),c.find(a.tradeinCartHeaderItemsPluralClass).removeClass("aok-hidden"))):c.addClass("aok-hidden")}catch(e){d.recordError(e,"Error occurred at createTradeInCartHeaderComponent")}return c},shouldShowPromos:function(){return this.tradeInReviewData.hasOwnProperty("promotionEligible")&&this.tradeInReviewData.promotionEligible&&Array.isArray(this.tradeInReviewData.promotionEligibilityText)&&
this.tradeInReviewData.promotionEligibilityText.length?!0:!1},shouldShowPromoHeader:function(){return 0===this.tradeInCartQuantity},createVerticalCardViewComponentWithTradeInEstimateContent:function(){try{if(this.searchTradeInImageIndicator&&this.estimatedMaxTiv)var a=f.bindDataToAsinSelectionTemplate(this.verticalComplexCardViewTemplate,{tradeinEstimateDetails:"classType",imageUrl:this.searchTradeInImageIndicator,maxTiv:this.estimatedMaxTiv});else d.recordError("Required data for vertical card view unavailable",
"Error encountered hitting search refinement request");var b=a.find(".selection-history-list"),c=this.categoryRefinementSelectionItemComponent;if(this.config.finalSearchResult){var g=d.generatePrettyTitle(this.config.finalSearchResult.asinTitle);a.find("#itemTitle").html(g)}else if(this.finalSearchResults){var h=this.finalSearchResults.asin;this.pastPurchasedEligibleItems&&e.each(this.pastPurchasedEligibleItems,function(b,c){h===c.asin&&a.find("#itemTitle").html(d.generatePrettyTitle(c.title))})}0<
this.currentAsin.length&&a.find("#itemTitle").html(d.generatePrettyTitle(this.currentAsin.title));0<this.config.translatedSelectionHistory.length?(this.translatedSelectionHistory=this.config.translatedSelectionHistory,this.config.translatedSelectionHistory.forEach(function(a){a=f.bindDataToAsinSelectionTemplate(c,{selectionItem:a});e(b).append(a)})):0<this.config.restrictionHistory.length?(this.restrictionHistory=this.config.restrictionHistory,this.config.restrictionHistory.forEach(function(a){a=
f.bindDataToAsinSelectionTemplate(c,{selectionItem:a.emittedData});e(b).append(a)})):a.find(".vertical-card-tradein-details").addClass("aok-hidden")}catch(k){throw"[Error at createVerticalCardViewComponentWithTradeInEstimateContent]"+k;}return a},createPastDevicePurchasesContainerViewComponent:function(){var b=this.pastPurchasedEligibleItems,c=f.bindDataToTemplate(this.customerPastDevicesPurchasesCarouselContainerTemplate,{instantPayable:this.config.hasOwnProperty("instantPayable")?this.config.instantPayable:
!1});c.find(a.eligibleItemsCountId).append(b.length);var d=c.find(a.eligibleItemListWrapper);this.createPastPurchasesForTradeInCardTemplates(b,this.pastPurchasedListViewTemplate,d);this.tradeInWrapper.append(c);return c},createPastPurchasesForTradeInCardTemplates:function(b,c,g){e.each(b,e.proxy(function(b,n){b=f.bindDataToTemplate(c,n);var e=d.formatCurrency(n.conditionOfferMap.NonFunctional.tiv),h=n.tradeInItemType===a.tradeInItemTypeEcho?d.formatCurrency(n.conditionOfferMap.Working.tiv):d.formatCurrency(n.conditionOfferMap.Good.tiv);
if(n.deviceTitle){var k=this.truncateString(n.deviceTitle,18);b.find(".item-device-title").removeClass("aok-hidden");b.find(".item-device-title").html(k);k=this.truncateString(d.generatePrettyTitle(n.title),15)}else k=this.truncateString(d.generatePrettyTitle(n.title),28);b.find(".item-title").html(k);""!==n.dateRegisteredString&&(b.find(".registered-date-wrapper").removeClass("aok-hidden"),b.find(a.dateRegisteredClass).html(n.dateRegisteredString));e!==h?(b.find(".tiv-estimate-container .min-tiv").html(e+
" -"),b.find(".tiv-estimate-container .max-tiv").html(h)):b.find(".tiv-estimate-container .max-tiv").html(e);g.append(b)},this))},truncateString:function(a,b){return a.length>b?a.substr(0,b-1)+"\x26hellip;":a},createShipmentDetailComponent:function(){try{var a=f.bindDataToAsinSelectionTemplate(this.shipmentDetailViewComponent);a.find(".shipByDate").html(this.tradeInReviewData.shipByDateString);a.find(".customerEmail").html(this.tradeInReviewData.emailAddress);if(this.tradeInReviewData.hasOwnProperty("defaultReturnAddress")){var b=
this.tradeInReviewData.defaultReturnAddress.line1+" - "+this.tradeInReviewData.defaultReturnAddress.city+" "+this.tradeInReviewData.defaultReturnAddress.postalCode;a.find(".customerAddress").html(b)}}catch(c){throw"[Error at createShipmentDetailComponent]"+c;}return a},createSubmitButtonComponent:function(){var b=this.tradeinSubmitWrapperComponent.clone();b.removeClass("aok-hidden");d.isGlEligibleForPastPurchases(this.tradeInProductGroup)?(k(e(b.find(a.submitButtonViewClass))).enable(),k(e(b.find(a.tradeInMoreItemsButtonViewClass))).enable()):
(k(e(b.find(a.submitButtonViewClass))).disable(),k(e(b.find(a.reviewButtonViewClass))).disable(),k(e(b.find(a.tradeInMoreItemsButtonViewClass))).disable());return b},areAllItemsAcceptWorseReturnType:function(a){if(!a)return!0;for(var b=0;b<a.length;b++){var c=a[b].selectedReturnType;if(!c||"ACCEPT_WORSE"!==c)return!1}return!0},createTermsAndAgreementComponent:function(b){try{var c=f.bindDataToAsinSelectionTemplate(b);k(e(c.find(".a"))).disable();d.isGlEligibleForPastPurchases(this.tradeInProductGroup)?
(k(e(c.find(a.submitButtonViewClass))).enable(),k(e(c.find(a.tradeInMoreItemsButtonViewClass))).enable()):(k(e(c.find(a.submitButtonViewClass))).disable(),k(e(c.find(a.reviewButtonViewClass))).disable(),k(e(c.find(a.tradeInMoreItemsButtonViewClass))).disable());this.areAllItemsAcceptWorseReturnType(this.tradeInReviewData.sanitizedItemsList)?(e(c).find(".terms-and-conditions-return-worse").addClass("aok-hidden"),e(c).find(".terms-and-conditions-accept-worse").removeClass("aok-hidden")):(e(c).find(".terms-and-conditions-return-worse").removeClass("aok-hidden"),
e(c).find(".terms-and-conditions-accept-worse").addClass("aok-hidden"));var g=!1;this.config.restrictionHistory.length?this.config.restrictionHistory.forEach(function(a,b){"manufacturer"===a.key&&"Apple"===a.emittedData&&(g=!0)}):d.recordError("Missing Restriction History\n"+JSON.stringify(this.config),"Error occured when access restriction history");g&&c.find(".alert-box").append(e(".tradein-templates .tradein-info-apple-device").clone())}catch(h){throw"[Error at createTermsAndAgreementComponent]"+
h;}return c},createSubmitTradeinInformation:function(){try{var a=e(".tradein-templates #submitTradeInInformationTemplate #submitTradeInInstructionText").clone()}catch(b){throw"[Error at createSubmitTradeinInformation]"+b;}return a},createAdjustedValueQuestionComponent:function(b){try{var c=d.findMinMaxTivInContainer(b),e=f.bindDataToAsinSelectionTemplate(this.appraisalSelectionComponentView,{minTiv:c[0],maxTiv:c[1]});e.find(a.appraisalTivHeaderClass).removeClass("aok-hidden");e.addClass("aok-hidden")}catch(g){throw"[Error at createAdjustedValueQuestionComponent]"+
g;}return e},createIPPreferenceComponent:function(){try{var a=f.bindDataToAsinSelectionTemplate(this.customerIpPreferenceComponent)}catch(b){throw"[Error at createIPPreferenceComponent]"+b;}return a},createFooterComponent:function(){try{var a=f.bindDataToAsinSelectionTemplate(this.tradeinFooterComponent)}catch(b){throw"[Error at createFooterComponent]"+b;}return a},createConditionQuestionComponent:function(b){try{for(var c=f.bindDataToAsinSelectionTemplate(this.conditionViewTemplate),d=0;d<b.length;d++){var g=
b[d],h=f.bindDataToAsinSelectionTemplate(this.binaryQuestionnaireListViewTemplate,g);if(g.hasOwnProperty("choices"))for(var k=e(h.find(".radio-button-list")),l=0;l<g.choices.length;l++)if(g.choices[l]){var m=g.choices[l],p;if(0===l)p=e(k).find("#binaryAnswerOne");else if(1===l)p=e(k).find("#binaryAnswerTwo");else continue;p.attr("name",g.id);p.attr("value",m.condition);e(p).find(".a-button-inner .a-button-text").html(m.descriptionText)}c.find(a.conditionQuestionnaireListClass).append(h)}}catch(q){throw"[Error at createConditionQuestionComponent]"+
q;}return c},createSubmitTradeInView:function(){try{var b=1<this.tradeInCartQuantity,c=[],f=this.finalSearchResults.asin,g;if(this.tradeInReviewData.hasOwnProperty("qtyLimitExceedItems"))d.isMobileVariant(this.deviceType)||this.tradeInWrapper.append(e(a.tradeInErrorExitButtonSelector).clone()).addClass("active"),this.tradeInWrapper.append(e(a.tradeInQuantityExceededErrorSelector).clone()).addClass("active");else if(this.tradeInReviewData.hasOwnProperty("nonTradeableItems"))d.isMobileVariant(this.deviceType)||
this.tradeInWrapper.append(e(a.tradeInErrorExitButtonSelector).clone()).addClass("active"),this.tradeInWrapper.append(e(a.tradeInNonTradeableErrorSelector).clone()).addClass("active");else{if(this.tradeInReviewData.hasOwnProperty("hazmatErrors")){var h=this.tradeInReviewData.hazmatErrors,k=!1;h.forEach(function(a){a.asin===f&&(k=!0)});if(k){d.isMobileVariant(this.deviceType)||this.tradeInWrapper.append(e(a.tradeInErrorExitButtonSelector).clone()).addClass("active");this.tradeInWrapper.append(e(a.tradeInMixHazmatErrorSelector).clone()).addClass("active");
return}g=e(a.tradeInMixHazmatCartItemErrorSelector).clone();var l=g.find(a.tradeInHazmatItemList);h.forEach(function(b){var c=g.find(a.tradeInHazmatListItemTemplate).clone();c.html(b.title).removeClass("aok-hidden");l.append(c)});d.recordTv2RefTag(a.refTagHazmatError,this.tradeInRefTagUrl,this.bifurcationRefTags)}this.promotionEligible=this.tradeInReviewData.hasOwnProperty("promotionEligible")?this.tradeInReviewData.promotionEligible:!1;c.push(this.createTradeInHeaderComponent(!0));if(this.shouldShowPromos()){this.promoData=
this.tradeInReviewData.promotionEligibilityText;this.tradeInReviewData.hasOwnProperty("promotionMessages")&&this.tradeInReviewData.promotionMessages&&(this.promoData=this.tradeInReviewData.promotionMessages);var m;m=v.isEnabled?this.generatePromoHeader(this.tradeInCartPromosTemplate,this.promoData):this.generatePromoHeaderNoExpander(this.tradeInCartPromosTemplate,this.promoData);c.push(m)}c.push(this.createTradeInCartHeaderComponent(this.tradeinCartSubmitViewHeaderTemplate));var p=0;this.getSanitizedItemListFromReviewData().forEach(function(a){a.asin===
f&&(p=a.tradeInValue)});if(b)c.push(this.createVerticalCardViewComponentWithTradeInTotalContent("tradeinTotalOfferDetails",p,f)),g&&c.push(g.addClass("active")),d.isGlEligibleForPastPurchases(this.tradeInProductGroup)?c.push(this.createTermsAndAgreementComponent(this.multiItemTermsAndAgreementViewTemplateDevices)):c.push(this.createTermsAndAgreementComponent(this.multiItemTermsAndAgreementViewTemplate));else{var r=this.hasDefaultReturnAddress();r&&c.push(r);c.push(this.createVerticalCardViewComponentWithTradeInTotalContent("tradeinTotalOfferDetails",
p,f));g&&c.push(g.addClass("active"));d.isWirelessVgProductGroup(this.tradeInProductGroup)&&c.push(this.createSubmitTradeinInformation());var u=this.createTermsAndAgreementComponent(this.termsAndAgreementViewTemplate);u.find(a.tradeinSubmitButtonComponentClass).addClass("aok-hidden");u.find(a.tradeInMoreItemsButtonContainerClass).addClass("aok-hidden");c.push(u);c.push(this.shipmentDetailsHeaderComponent);c.push(this.createShipmentDetailComponent());q.isEnabled&&this.tradeInReviewData.showOfflineOption&&
(this.showOfflineOption=!0,this.offlineDropOffLocations=this.tradeInReviewData.nearbyProcessors,c.push(this.dropOffBannerNoLinkComponent));var w=this.tradeInReviewData.hasOwnProperty("isMFAMarketplace")&&this.tradeInReviewData.isMFAMarketplace;this.tradeInReviewData.hasOwnProperty("instantPaymentEligible")&&this.tradeInReviewData.instantPaymentEligible&&w&&d.isCETechGl(this.tradeInProductGroup)&&c.push(this.createIPPreferenceComponent());c.push(this.createSubmitButtonComponent())}c.push(this.createFooterComponent());
this.renderTemplateView(c)}}catch(B){d.recordError(B,"Error encountered rendering "+this.navCurrentView),this.tradeInWrapper.append(e(".tradein-templates .tradein-general-error").clone()).addClass("active")}},createTradeInConditionView:function(){try{var a=[],b=this.createTradeInHeaderComponent(!0);a.push(b);b=[];this.config.hasOwnProperty("selectionDetails")&&(b=this.config.selectionDetails.translatedPromoStrings||[]);this.finalSearchResults.translatedPromoStrings&&0===b.length&&(b=this.finalSearchResults.translatedPromoStrings);
if(this.shouldShowPromoHeader()){var c=this.generatePromoHeader(this.tradeInPromoPreviewViewTemplate,b);a.push(c)}var g=this.createTradeInCartHeaderComponent(this.tradeinCartHeaderTemplate);a.push(g);var h=this.createVerticalCardViewComponentWithTradeInEstimateContent();a.push(h);var l=this.createConditionQuestionComponent(this.finalSearchResults.gradingQuestion);a.push(l);this.conditionSelectionMap={tradeInQuestions:this.finalSearchResults.gradingQuestion,conditionOfferMap:this.finalSearchResults.conditionOfferMap,
gradedCondition:null,tradeInValue:null,tradeInQuestionResponses:{}};var m=this.createAdjustedValueQuestionComponent(this.finalSearchResults.conditionOfferMap);a.push(m);var p=f.bindDataToAsinSelectionTemplate(this.tradeInSubmitConditionButtonTemplate);k(e(p.find(".continue-trigger"))).disable();a.push(p);var q=this.createFooterComponent();a.push(q);this.renderTemplateView(a)}catch(r){d.recordError(r,"Error encountered rendering "+this.navCurrentView),this.tradeInWrapper.append(e(".tradein-templates .tradein-general-error").clone()).addClass("active")}this.showVerticalImageCardView=
!1},createTradeInChangeConditionView:function(){try{var a=this.changeConditionData,b=[];b.push(this.createTradeInHeaderComponent(!0));b.push(this.createTradeInCartHeaderComponent(this.tradeinCartHeaderTemplate));var c=f.bindDataToAsinSelectionTemplate(this.verticalComplexCardViewTemplate,{tradeinEstimateDetails:"classType",imageUrl:a.verticalImageUrl,maxTiv:a.maxTiv});b.push(c);var g=c.find(".selection-history-list"),h=this.categoryRefinementSelectionItemComponent;0<this.translatedSelectionHistory.length?
this.translatedSelectionHistory.forEach(function(a){a=f.bindDataToAsinSelectionTemplate(h,{selectionItem:a});e(g).append(a)}):this.verticalComplexCardViewTemplate.find(".vertical-card-tradein-details").addClass("aok-hidden");b.push(this.createConditionQuestionComponent(a.gradingQuestion));this.conditionSelectionMap={tradeInQuestions:a.gradingQuestion,conditionOfferMap:a.conditionOfferMap,gradedCondition:null,tradeInValue:null,tradeInQuestionResponses:{}};b.push(this.createAdjustedValueQuestionComponent(a.conditionOfferMap));
var l=f.bindDataToAsinSelectionTemplate(this.tradeInSubmitConditionButtonTemplate);k(e(l.find(".continue-trigger"))).disable();b.push(l);b.push(this.createFooterComponent());this.renderTemplateView(b)}catch(m){d.recordError(m,"Error encountered rendering "+this.navCurrentView),this.tradeInWrapper.append(e(".tradein-templates .tradein-general-error").clone()).addClass("active")}},generatePromoHeader:function(a,b){if(b&&0<b.length){a.removeClass("aok-hidden");var c=e("\x3cdiv/\x3e"),d=e("#promoMessageContentTemplate");
b.forEach(function(a){var b={displayTitle:a};a.hasOwnProperty("subtitle")&&(b={displayTitle:a.title,subtitle:a.subtitle});a=f.bindDataToAsinSelectionTemplate(d,b);c.append(a)});var g=a.clone();1<b.length?(g.find("#finalPromotionCount").html(b.length.toString()),g.find(".tradein-promo-expander-view").removeClass("aok-hidden"),g.find(".tradein-promo-expander-row-container").html(c.html())):(g.find(".tradein-cart-promo-view").removeClass("aok-hidden"),g.find(".tradein-cart-promo-view").html(c.html()))}return g},
generatePromoHeaderNoExpander:function(a,b){var c="";if(b&&0<b.length){var d=f.bindDataToAsinSelectionTemplate(a);d.removeClass("aok-hidden");c=d.clone();c.empty();b.forEach(function(a){var b={displayTitle:a};a.hasOwnProperty("subtitle")&&(b={displayTitle:a.title,subtitle:a.subtitle});a=f.bindDataToAsinSelectionTemplate(d,b);c.append(a)})}return c},createTradeInNextStepsView:function(){try{var b=[];b.push(this.createTradeInHeaderComponent(!1));b.push(f.bindDataToAsinSelectionTemplate(this.successfulTradeInBannerComponentView));
var c,g=this.tradeInSubmitData.ipItems+this.tradeInSubmitData.nonIpItems,h=this.getIsMixedOfferFromSubmitData(),k=this.getIsIpOnlyOfferFromSubmitData(),l=this.customerIpPreference===a.instantPaymentNow&&k;1<g?b.push(this.createMultiItemConfirmationView()):b.push(this.createSingleItemConfirmationView());c=h?this.mixedOfferNextStepsTemplate.clone():f.bindDataToAsinSelectionTemplate(this.tradeinReviewYourOrderNextStepTemplate,{instantPaymentEligible:l});if(this.shouldShowPromos()){this.promoData=this.tradeInReviewData.promotionEligibilityText;
this.tradeInReviewData.hasOwnProperty("promotionMessages")&&this.tradeInReviewData.promotionMessages&&(this.promoData=this.tradeInReviewData.promotionMessages);var m;m=v.isEnabled?this.generatePromoHeader(this.tradeInCartPromosTemplate,this.promoData):this.generatePromoHeaderNoExpander(this.tradeInCartPromosTemplate,this.promoData);b.push(m)}c.find(".shipByDate").html(this.tradeInSubmitData.shipByDate);c.find(".customerEmail").html(this.tradeInSubmitData.customerEmailAddress);q.isEnabled&&this.tradeInReviewData.showOfflineOption&&
(this.showOfflineOption=!0,this.offlineDropOffLocations=this.tradeInReviewData.nearbyProcessors,c.find(".next-steps-list").append(this.dropOffLocationsTemplate));b.push(c);this.renderTemplateView(b)}catch(p){d.recordError(p,"Error encountered rendering "+this.navCurrentView),this.tradeInWrapper.append(e(".tradein-templates .tradein-general-error").clone()).addClass("active")}},createMultiItemConfirmationView:function(){var a=this.tradeInSubmitData.ipItems,b=this.tradeInSubmitData.nonIpItems,c=a+b,
d=this.getIsMixedOfferFromSubmitData(),e=this.getIsIpOnlyOfferFromSubmitData(),e=f.bindDataToAsinSelectionTemplate(this.multiItemConfirmationOrderDetailsViewComponent,{mixedOffer:d,ipOnlyOffer:e,maxTiv:this.tradeInSubmitData.totalAmount,ipTiv:this.tradeInSubmitData.ipAmount,nipTiv:this.tradeInSubmitData.nonIPAmount});d?(e.find(".confirmedIpItemCount").html(a),e.find(".confirmedNipItemCount").html(b)):e.find(".confirmedItemCount").html(c);return e},createSingleItemConfirmationView:function(){this.searchTradeInImageIndicator||
(this.searchTradeInImageIndicator=this.getSanitizedItemListFromReviewData()[0].imageUrl);var a=this.finalSearchResults?this.finalSearchResults.asin:this.getSanitizedItemListFromReviewData()[0].asin;return this.createVerticalCardViewComponentWithTradeInTotalContent("tradeinConfirmationOrderDetails",this.tradeInSubmitData.totalAmount,a)},createRestrictionItemView:function(){try{var b=this.config,c=b.selectionDetails,g=[];b.hasOwnProperty("expectedPages")?this.expectedPages=b.expectedPages+2:d.recordError("expectedPages property missing from config",
"tradeinConfig.expectedPages");g.push(this.createTradeInHeaderComponent(1!==b.pageIndex));g.push(this.createTradeInCartHeaderComponent(this.tradeinCartHeaderTemplate));1===this.config.pageIndex&&d.isGlEligibleForPromotions(this.tradeInProductGroup)&&g.push(this.promotionInformationComponent);1===b.pageIndex&&d.isGlEligibleForPastPurchases(this.tradeInProductGroup)&&0<this.pastPurchasedEligibleItems.length&&g.push(this.createPastDevicePurchasesContainerViewComponent());this.shouldShowPromoHeader()&&
g.push(this.generatePromoHeader(this.tradeInPromoPreviewViewTemplate,c.translatedPromoStrings||[]));this.showVerticalImageCardView&&(g.push(this.createVerticalCardViewComponentWithTradeInEstimateContent()),this.showVerticalImageCardView=!1);var h=f.bindCategoryRefinementDataToTemplate(this.searchRefinementItemSelectionTemplate,c,this.deviceType);h.find(a.howToLinkHelperTitleId).text(c.refinementTitle);this.tradeInProductGroup===a.tradeInEchoGl&&h.find("#howToHelper").addClass("aok-hidden");this.populateUnavailableOffers(h);
g.push(h);g.push(this.createFooterComponent());this.renderTemplateView(g,e.proxy(function(){f.normalizeGridRowHeights(h)}))}catch(k){d.recordError(k,"Error encountered rendering "+this.navCurrentView),this.tradeInWrapper.append(e(".tradein-templates .tradein-general-error").clone()).addClass("active")}},createRefinementSearchView:function(){var b=this.config,c=b.selectionDetails,g=[],h=this.tradeInSearchCurrentState.term&&0<this.tradeInSearchCurrentState.term.length;b.hasOwnProperty("expectedPages")?
this.expectedPages=b.expectedPages+2:d.recordError("expectedPages property missing from config","tradeinConfig.expectedPages");g.push(this.createTradeInHeaderComponent(1!==b.pageIndex));g.push(this.createTradeInCartHeaderComponent(this.tradeinCartHeaderTemplate));this.shouldShowPromoHeader()&&g.push(this.generatePromoHeader(this.tradeInPromoPreviewViewTemplate,c.translatedPromoStrings||[]));this.overrideRefinementTitleForSearch(c);var k=f.bindCategoryRefinementDataToTemplate(this.refinementSearchViewTemplate,
c,this.deviceType,{searchResultsExist:0<c.selectionItemsAttributeList.length,searchOffersOnly:this.searchOffersOnly,isFirstSearch:!h});k.find(a.howToLinkHelperTitleId).text(c.refinementTitle);d.isWirelessVgProductGroup(this.tradeInProductGroup)||k.find("#howToHelper").addClass("aok-hidden");this.updateSearchCounts(k);this.populateUnavailableOffers(k);c.endOfResults?k.find(a.searchLoadMoreResultsWrapperClass).addClass("aok-hidden"):k.find(a.searchLoadMoreResultsWrapperClass).removeClass("aok-hidden");
g.push(k);g.push(this.createFooterComponent());this.renderTemplateView(g,e.proxy(function(){f.normalizeGridRowHeights(k);h&&this.getSearchInput(this.tradeInWrapper).val(this.tradeInSearchCurrentState.term)},this))},handleReturnAddressChange:function(b){var c=e(b.currentTarget);d.isMobileVariant(this.deviceType)&&(c=e(b));d.recordTv2RefTag(a.refTagReturnAddressUpdateRequest,this.tradeInRefTagUrl,this.bifurcationRefTags);this.loadingSpinnerShow();l.post(this.tradeInReviewUrl,{params:{addressId:c.attr("value"),
requestToken:d.getCsrfTokenByKey(a.csrfReviewRequestKey,this.config)},success:e.proxy(function(b){d.updateCsrfTokenByKey(a.csrfReviewRequestKey,b,this.config);c.closest(".popover-content-overlay").addClass("aok-hidden");this.loadingSpinnerHide();this.tradeInReviewData=b;this.createView()},this),error:e.proxy(function(a){this.handleRequestError(a,"TradeIn return address error","Error encountered during TradeIn return address update request")},this)})},cleanState:function(){this.restrictionSelectionPage=
[];this.priceHistory=[];this.navCurrentView=null;this.estimatedMaxTiv=0;this.invalidReturnAddress=this.isProcessing=this.showVerticalImageCardView=!1;this.conditionSelectionMap=this.finalSearchResults=this.searchTradeInImageIndicator=null;this.isChangeConditionContext=!1;this.tradeInReviewData={};this.tradeInSearchCurrentState={term:""};this.bifurcationRefTags=[];e(a.searchSuggestionsClass).remove()},clearAllViews:function(){this.tradeInWrapper.children().each(function(){e(this).data("keep")||e(this).remove()})},
handleRefinementSubmit:function(b){if(!this.selectionInProgress){var c=this.config,f=c.restrictionHistory,g=e(b.target);b=g.data("tradeinSupplementaryData");var h=g.data("refinementKey"),g=g.data("refinementValue"),h={key:h,emittedData:g};h.key&&h.emittedData&&(f.push(h),-1!==a.BIFURCATION_REF_TAG.indexOf(h.key)&&this.generateBifurcationTag(h.emittedData));b.maxTiv&&(this.estimatedMaxTiv=b.maxTiv,0<b.maxTiv?this.priceHistory.push(this.estimatedMaxTiv):d.recordError("Invalid TIV","TIV is zero"));c=
{configVersion:c.configVersion,requestToken:d.getCsrfTokenByKey(a.csrfSearchAsinCategoryItemKey,this.config),productGroup:this.tradeInProductGroup,restrictionHistory:JSON.stringify(f),currentAsin:d.getCurrentAsin(),pageIndex:c.pageIndex+1};this.callForwardRefinementSelection(c)}},handlePastPurchaseRefinementSelect:function(b){if(!this.selectionInProgress){var c=e(b.target)[0].dataset.asin,f,g,h,k;e.each(this.pastPurchasedEligibleItems,e.proxy(function(b,e){e.asin===c&&(this.currentAsin.asin=c,this.currentAsin.title=
d.generatePrettyTitle(e.title),g=e.imageUrl,h=this.questionnaires[e.tradeInItemType].questions,k=e.conditionOfferMap,f=e.tradeInItemType===a.tradeInItemTypeEcho?e.conditionOfferMap.Working.tiv:e.conditionOfferMap.Good.tiv)},this));b=this.config;var l=b.restrictionHistory;b={configVersion:b.configVersion,requestToken:d.getCsrfTokenByKey(a.csrfSearchAsinCategoryItemKey,this.config),productGroup:this.tradeInProductGroup,restrictionHistory:JSON.stringify(l),currentAsin:d.getCurrentAsin(),maxTiv:f,verticalImageUrl:g,
tradeInQuestions:h,conditionOfferMap:k,asin:c,pageIndex:b.pageIndex+1};this.callFastForwardToSelfGrading(b)}},handleRefinementSearchFormSubmit:function(b){if(!this.selectionInProgress){if(b){b.preventDefault();b=e(b.currentTarget);b=this.getSearchInput(b);b=l.trim(b.val());if(!b)return;this.tradeInSearchCurrentState.term=b}b=this.config;var c=b.restrictionHistory;b={configVersion:b.configVersion,requestToken:d.getCsrfTokenByKey(a.csrfSearchAsinCategoryItemKey,b),productGroup:this.tradeInProductGroup,
restrictionHistory:JSON.stringify(c),currentAsin:d.getCurrentAsin(),keyword:this.tradeInSearchCurrentState.term,pageIndex:b.pageIndex,pageSize:this.searchPageSize,filterEligibleOffers:this.searchOffersOnly,resultIndex:0};this.callForwardRefinementSelection(b)}},handleLoadMoreSearchResults:function(){this.selectionInProgress=!0;var b=this.config,b={configVersion:b.configVersion,requestToken:d.getCsrfTokenByKey(a.csrfSearchAsinCategoryItemKey,b),productGroup:this.tradeInProductGroup,restrictionHistory:JSON.stringify(b.restrictionHistory),
currentAsin:d.getCurrentAsin(),keyword:this.tradeInSearchCurrentState.term,pageIndex:b.pageIndex,pageSize:this.searchPageSize,filterEligibleOffers:this.searchOffersOnly,resultIndex:b.selectionDetails.searchOffsetIndex};this.loadingSpinnerShow();l.post(this.tradeInSearchCategoryRefinementUrl,{params:b,success:e.proxy(function(b){this.loadingSpinnerHide();this.selectionInProgress=!1;d.updateCsrfTokenByKey(a.csrfSearchAsinCategoryItemKey,b,this.config);this.config=b;this.updateCartHeaderData();b=this.tradeInWrapper.find(a.refinementContentWrapperClass);
var c=this.config.selectionDetails;this.overrideRefinementTitleForSearch(c);var n=f.bindCategoryRefinementDataToTemplate(this.refinementSearchViewTemplate,c,this.deviceType);this.populateUnavailableOffers(n);n=n.find(a.refinementContentWrapperClass);b.append(n.children());f.normalizeGridRowHeights(b);this.updateSearchCounts(this.tradeInWrapper.find(a.refinementSelectionViewWrapperClass));c.hasOwnProperty("endOfResults")&&c.endOfResults?e(a.refinementSelectionViewWrapperClass).find(a.searchLoadMoreResultsWrapperClass).addClass("aok-hidden"):
e(a.refinementSelectionViewWrapperClass).find(a.searchLoadMoreResultsWrapperClass).removeClass("aok-hidden")},this),error:e.proxy(function(a){this.selectionInProgress=!1;this.handleRequestError(a,"Search refinement selection error","Error encountered hitting search refinement request")},this)})},handlePreviousButton:function(){if(!this.selectionInProgress){var b=this.getCurrentViewForRefTag(),c=this.restrictionSelectionPage.pop(),f=this.restrictionSelectionPage[this.restrictionSelectionPage.length-
1];this.navCurrentView=f;d.recordTv2RefTag(a.refTagBackButton+b,this.tradeInRefTagUrl,this.bifurcationRefTags);if(d.isGlEligibleForPastPurchases(this.tradeInProductGroup)&&0===this.config.restrictionHistory.length)this.clearAllViews(),this.createRestrictionItemView();else switch(f){case this.navViews.refinementSelectionView:this.handleNavigateBackToSelectionPage(c);break;case this.navViews.refinementSearchView:this.handleNavigateBackToSearchPage(c);break;case this.navViews.tradeInConditionView:this.handleNavigateBackToConditionPage(c);
break;case this.navViews.submitTradeInView:this.handleNavigateBackToReviewPage(c);break;case this.navViews.tradeInCartView:this.handleNavigateBackToCartPage(c);break;default:this.clearAllViews(),d.recordError("Error encountered navigating from "+c+" back to "+f),this.tradeInWrapper.append(e(".tradein-templates .tradein-general-error").clone()).addClass("active")}}},handleNavigateBackToSelectionPage:function(b){var c=this.config.restrictionHistory;if(b!==this.navViews.tradeInCartView){this.config.pageIndex--;
var e=c.pop();this.priceHistory.pop();-1!==a.BIFURCATION_REF_TAG.indexOf(e.key)&&this.bifurcationRefTags.pop()}b===this.navViews.refinementSearchView&&(this.tradeInSearchCurrentState.term="");b={configVersion:this.config.configVersion,requestToken:d.getCsrfTokenByKey(a.csrfSearchAsinCategoryItemKey,this.config),productGroup:this.tradeInProductGroup,restrictionHistory:JSON.stringify(c),currentAsin:d.getCurrentAsin(),pageIndex:this.config.pageIndex};this.restrictionSelectionPage.pop();this.callForwardRefinementSelection(b)},
handleNavigateBackToSearchPage:function(b){var c=this.config.restrictionHistory,e=this.tradeInSearchCurrentState.term&&0<this.tradeInSearchCurrentState.term.length?this.tradeInSearchCurrentState.term:"";b!==a.tradeInCartViewClass&&(this.config.pageIndex--,c.pop(),this.priceHistory.pop());b={configVersion:this.config.configVersion,requestToken:d.getCsrfTokenByKey(a.csrfSearchAsinCategoryItemKey,this.config),productGroup:this.tradeInProductGroup,restrictionHistory:JSON.stringify(c),currentAsin:d.getCurrentAsin(),
keyword:e,pageIndex:this.config.pageIndex,pageSize:this.searchPageSize,filterEligibleOffers:this.searchOffersOnly,resultIndex:0};this.restrictionSelectionPage.pop();this.callForwardRefinementSelection(b)},handleNavigateBackToConditionPage:function(b){this.restrictionSelectionPage.pop();var c={configVersion:this.config.configVersion,requestToken:d.getCsrfTokenByKey(a.csrfSearchAsinCategoryItemKey,this.config),productGroup:this.tradeInProductGroup,restrictionHistory:JSON.stringify(this.config.restrictionHistory),
currentAsin:d.getCurrentAsin(),pageIndex:this.config.pageIndex};b===a.submitTradeInWrapperClass?this.finalSearchResults&&this.finalSearchResults.hasOwnProperty("asin")&&this.doTradeInItemRemove(this.finalSearchResults.asin,e.proxy(function(){this.callForwardRefinementSelection(c)},this)):this.callForwardRefinementSelection(c)},handleNavigateBackToReviewPage:function(b){if(b===a.tradeInCartViewClass){var c=this.finalSearchResults.asin;this.getSanitizedItemListFromReviewData().some(function(a){return a.asin===
c})?this.doTradeInReviewValidation(e.proxy(function(){this.selectionInProgress=!1;this.navCurrentView=this.navViews.submitTradeInView;this.createView()},this)):this.handleTradeInMoreItems()}},handleNavigateBackToCartPage:function(a){a===this.navViews.tradeInConditionView&&(this.isChangeConditionContext=!1,this.restrictionSelectionPage.pop(),this.handleNavigateToCart())},updateCartHeaderData:function(){var a=this.config;a.hasOwnProperty("cartItems")&&(this.tradeInCartQuantity=a.cartItems.length,this.tradeInCartTiv=
a.cartItems.reduce(function(a,b){return a+b.price},0))},handleNavigateToCart:function(){this.doTradeInReviewValidation(e.proxy(function(){this.navCurrentView=this.navViews.tradeInCartView;this.createView();this.restrictionSelectionPage.push(this.navCurrentView)},this))},handlePrintShippingLabel:function(){var b="https://"+r.location.host;-1<b.indexOf("aka.corp.amazon.com")&&(b="https://development.amazon.com");b=b+"/tradein/ya/print-label/"+this.tradeInSubmitData.orderId+"?loc\x3d"+this.config.locale+
"\x26ref\x3d"+a.refTagPrintShippingLabel+"_"+d.getDeviceType()+"_"+d.getProductGroup();r.open(encodeURI(b),"_blank")},createTradeInCartView:function(){try{var b=[];b.push(this.createTradeInHeaderComponent(!0));var c=this.tradeInCartTemplate.clone(),g=this.getSanitizedItemListFromReviewData();c.find(a.tradeinCartTotalTivElement).html(d.formatCurrency(this.tradeInReviewData.orderTotalGC));c.find(a.tradeinCartGCValueIpElement).html(d.formatCurrency(this.tradeInReviewData.orderTotalPaidInstantly));c.find(a.tradeinCartGCValueNonIpElement).html(d.formatCurrency(this.tradeInReviewData.orderTotalPaidOnGrading));
d.isGlEligibleForPastPurchases(this.tradeInProductGroup)&&c.find(".tradein-cart-view .tradein-cart-view-review-text").addClass("aok-hidden");var h=[],l=[];e.each(g,e.proxy(function(a,b){a=f.bindDataToAsinSelectionTemplate(this.tradeinCartItemComponent,{title:d.generatePrettyTitle(b.title),tradeInValue:b.tradeInValue,imageUrl:b.imageUrl,instantPaymentEligible:b.instantPayable,asin:b.asin})[0].outerHTML;b.instantPayable?h+=a:l+=a},this));0<h.length?c.find(a.tradeinCartIpItemsList).append(h):(c.find(a.tradeinCartIpItemsSection).addClass("aok-hidden"),
c.find(a.tradeinCartNonIpItemsSection+".a-divider-normal").addClass("aok-hidden"));0<l.length?c.find(a.tradeinCartNonIpItemsList).append(l):c.find(a.tradeinCartNonIpItemsSection).addClass("aok-hidden");if(this.shouldShowPromos()){this.promoData=this.tradeInReviewData.promotionEligibilityText;this.tradeInReviewData.hasOwnProperty("promotionMessages")&&this.tradeInReviewData.promotionMessages&&(this.promoData=this.tradeInReviewData.promotionMessages);var m;m=v.isEnabled?this.generatePromoHeader(this.tradeInCartPromosTemplate,
this.promoData):this.generatePromoHeaderNoExpander(this.tradeInCartPromosTemplate,this.promoData);b.push(m)}b.push(c);b.push(this.shipmentDetailsHeaderComponent);b.push(this.createShipmentDetailComponent());var p=this.tradeInReviewData.hasOwnProperty("isMFAMarketplace")&&this.tradeInReviewData.isMFAMarketplace;this.tradeInReviewData.hasOwnProperty("instantPaymentEligible")&&this.tradeInReviewData.instantPaymentEligible&&p&&d.isCETechGl(this.tradeInProductGroup)&&b.push(this.createIPPreferenceComponent());
q.isEnabled&&this.tradeInReviewData.showOfflineOption&&(this.showOfflineOption=!0,this.offlineDropOffLocations=this.tradeInReviewData.nearbyProcessors,b.push(this.dropOffBannerNoLinkComponent));var r=this.tradeinSubmitButtonComponent.clone();k(r.find(a.submitButtonViewClass)).enable();b.push(r);b.push(this.createFooterComponent());this.renderTemplateView(b)}catch(u){d.recordError(u,"Error encountered rendering "+this.navCurrentView),this.tradeInWrapper.append(e(".tradein-templates .tradein-general-error").clone()).addClass("active")}},
handleRemoveCartItem:function(a){a=e(a.currentTarget).data("asin");this.doTradeInItemRemove(a,e.proxy(function(){1===this.getSanitizedItemListFromReviewData().length?(this.tradeInReviewData={},this.handlePreviousButton()):(this.restrictionSelectionPage.pop(),this.handleNavigateToCart())},this))},handleNavigateToChangeCondition:function(a){this.selectionInProgress=!0;this.loadingSpinnerShow();a={asin:e(a.target)[0].dataset.asin};l.get(this.tradeInGetSelfGradingQuestionnaireUrl,{params:a,success:e.proxy(function(a){this.loadingSpinnerHide();
this.selectionInProgress=!1;this.navCurrentView=this.navViews.tradeInConditionView;this.restrictionSelectionPage.push(this.navCurrentView);this.isChangeConditionContext=!0;this.changeConditionData=a.finalSearchResult;this.createView()},this),error:e.proxy(function(a){this.selectionInProgress=!1;this.handleRequestError(a,"getSelfGradingQuestionnaire error","Error encountered calling getSelfGradingQuestionnaire")},this)})},handleTermsAndAgreementCheckboxSelection:function(b){b=e(b.currentTarget);var c=
!0;e(b).closest(".termsAndAgreementContent").find(".agreement-checkbox").each(function(a,b){e(b).find("input").get(0).checked||(c=!1)});b=k(a.agreementCheckboxTarget);c&&!this.invalidReturnAddress?b.enable():b.disable()},handleAdjustedValueAgreementButton:function(a){a=e(a.currentTarget);var b=a.closest(".appraisal-container");e(b).find(".adjusted-value-agreement-button").each(function(a,b){k(e(b)).setStatus("normal")});b=e(a.closest(".adjusted-value-agreement-button"));k(b).setStatus("selected");
b=b.find("input");this.conditionSelectionMap.tradeInQuestionResponses[b.attr("name")]=b.attr("value");this.toggleConditionState(this.conditionSelectionMap,a,b.attr("name"))},handleIpPreferenceButton:function(b){b=e(b.currentTarget);var c=b.closest(".ip-pref-container");e(c).find(".ip-preference-button").each(function(a,b){k(e(b)).setStatus("normal")});b=e(b.closest(".ip-preference-button"));k(b).setStatus("selected");(this.customerIpPreference=b.find("input").attr("value"))&&this.customerIpPreference!==
a.instantPaymentNow?(this.tradeInWrapper.find(".instantPaymentPreference-mfa").addClass("aok-hidden"),d.recordTv2RefTag(a.refTagIPDowngrade,this.tradeInRefTagUrl,this.bifurcationRefTags)):(this.tradeInWrapper.find(".instantPaymentPreference-mfa").removeClass("aok-hidden"),d.recordTv2RefTag(a.refTagIPUpgrade,this.tradeInRefTagUrl,this.bifurcationRefTags))},handleTradeInSubmit:function(){if(!this.hasPendingRequest){this.loadingSpinnerShow();this.hasPendingRequest=!0;var b=this.tradeInReviewData.instantPaymentEligible?
"ip":"nip";this.customerIpPreference||(this.customerIpPreference=a.instantPaymentNow);l.post(this.tradeInSubmitUrl+b,{params:{requestToken:d.getCsrfTokenByKey(a.csrfSubmitRequestKey,this.config),currentAsin:d.getCurrentAsin(),customerIpPreference:this.customerIpPreference,isStorefront:this.isStorefront,productGroup:this.tradeInProductGroup},success:e.proxy(function(b){this.tradeInSubmitData=b;try{if(this.tradeInSubmitData.hasOwnProperty("mfaUrl")&&this.tradeInSubmitData.mfaUrl){d.redirectToMFA(this.tradeInSubmitData.mfaUrl);
return}this.promotionEligible&&(this.promosApplied.push({productGroup:this.tradeInProductGroup,applied:!0}),r.sessionStorage.setItem("tradein-promos-applied",JSON.stringify(this.promosApplied)))}catch(c){d.recordError(c,a.sessionStorageAccessErrorMsg)}this.loadingSpinnerHide();this.hasPendingRequest=!1;this.updatePostTradeInMessage();this.navCurrentView=this.navViews.restrictionSearchTradeInNextStepView;this.config.pageIndex=this.expectedPages;this.createView();this.restrictionSelectionPage.push(this.navCurrentView);
d.recordTv2RefTag(a.refTagEnd,this.tradeInRefTagUrl,this.bifurcationRefTags)},this),error:e.proxy(function(a){this.hasPendingRequest=!1;this.clearAllViews();this.handleRequestError(a,"TradeIn submit error","Error encountered during TradeIn submit request")},this)})}},updatePostTradeInMessage:function(){var b=e(a.tradeInLaunchButtonDeclarativeActionSelector).data("action");!d.isTradeInLaunchedFromWisper(b)&&c&&0!==e(c.selectors.tradeInCCCardTemplate).length?(this.updateCCCardMessage(),d.recordMetric(this.tradeInProductGroup+
"_submittedFromCCCard")):(this.updateLaunchButtonText(),(g.isEnabled||p.isEnabled)&&d.isGlEligibleForCCCard(this.tradeInProductGroup)&&d.recordMetric(this.tradeInProductGroup+"_submittedFromBuyBox"))},updateCCCardMessage:function(){var a=c.selectors,f=this.getIsIpOnlyOfferFromSubmitData(),g=this.getIsMixedOfferFromSubmitData(),h=this.getIsPromotionEligibleFromReviewData(),k=e(a.successMessage).clone(),l=k.find(a.tivMessage),m=e(a.tradeInMessageTemplate).clone();f?(m=m.find(a.ipTradeInMessage),m.find(a.ccCardTotalTiv).text(d.formatCurrency(this.tradeInReviewData.orderTotalGC))):
g?(m=m.find(a.mixedTradeInMessage),m.find(a.ccCardTotalTiv).text(d.formatCurrency(this.tradeInReviewData.orderTotalGC)),m.find(a.ccCardIpTiv).text(d.formatCurrency(this.tradeInReviewData.orderTotalPaidInstantly))):(m=m.find(a.postGradeTradeInMessage),m.find(a.ccCardTotalTiv).text(d.formatCurrency(this.tradeInReviewData.orderTotalGC)));l.append(m);var l=this.tradeInReviewData.promotionEligibilityText,p=l.length;if(!h||1>p)k.remove(a.promoMessage);else{var h=k.find(a.promoMessage),m=e(a.promoContent).clone(),
q=m.find(a.promoTitle),r=m.find(a.promoSubtitle);if(1<p){var v=e(a.promoTitleMultiple).clone();v.find(a.lastPromoTitle).text(l[p-1]);v.find(a.remainingPromoAmount).text(p-1);q.text(v.text())}else p=e(a.promoTitleSingle).clone(),p.find(a.singlePromoTitle).text(l[0]),q.text(p.text());f=f||g?e(a.ipPromoSubtitle).text():e(a.nipPromoSubtitle).text();r.text(f);h.append(m)}e(a.expanderContent).empty().append(k);e(a.subtitleWrapper).empty().append(e(a.submittedMessage));"true"===e(a.collapseAfterSubmission).val()&&
b&&b.toggleCard(!1)},handleTradeInMoreItems:function(){if(!this.selectionInProgress){var b=this.config;b.pageIndex=1;b.restrictionHistory=[];this.cleanState();b={configVersion:b.configVersion,requestToken:d.getCsrfTokenByKey(a.csrfSearchAsinCategoryItemKey,b),productGroup:this.tradeInProductGroup,restrictionHistory:JSON.stringify(b.restrictionHistory),pageIndex:b.pageIndex};this.callForwardRefinementSelection(b)}},callFastForwardToSelfGrading:function(b){try{this.selectionInProgress=!0;this.loadingSpinnerShow();
var c=b.maxTiv;this.searchTradeInImageIndicator=b.verticalImageUrl;this.finalSearchResults={gradingQuestion:b.tradeInQuestions,conditionOfferMap:b.conditionOfferMap,asin:b.asin};l.post(this.tradeInSearchCategoryRefinementUrl,{params:b,success:e.proxy(function(b){this.selectionInProgress=!1;d.updateCsrfTokenByKey(a.csrfSearchAsinCategoryItemKey,b,this.config);this.config=b;this.estimatedMaxTiv=c;this.navCurrentView=this.navViews.tradeInConditionView;this.updateCartHeaderData();this.loadingSpinnerHide();
this.createView();this.restrictionSelectionPage.push(this.navCurrentView)},this),error:e.proxy(function(a){this.selectionInProgress=!1;this.handleRequestError(a,"Search refinement selection error","Error encountered hitting search refinement request")},this)})}catch(f){this.selectionInProgress=!1,this.clearAllViews(),this.tradeInWrapper.append(e(".tradein-templates .tradein-general-error").clone()).addClass("active")}},callForwardRefinementSelection:function(b){try{this.selectionInProgress=!0,this.loadingSpinnerShow(),
l.post(this.tradeInSearchCategoryRefinementUrl,{params:b,success:e.proxy(function(b){this.selectionInProgress=!1;d.updateCsrfTokenByKey(a.csrfSearchAsinCategoryItemKey,b,this.config);this.config=b;if(b.hasOwnProperty("selectionDetails")){var c=b.selectionDetails;c.hasOwnProperty("searchRestrictionAttributes")&&c.searchRestrictionAttributes.hasOwnProperty("verticalImageUrl")&&(this.showVerticalImageCardView=!0,this.searchTradeInImageIndicator=c.searchRestrictionAttributes.verticalImageUrl);b=b.selectionDetails.viewType;
b===a.complexCardRefinementSelectionViewType||b===a.simpleCardRefinementSelectionViewType||b===a.containedButtonRefinementSelectionViewType?this.navCurrentView=this.navViews.refinementSelectionView:b===a.searchRefinementViewType&&(this.navCurrentView=this.navViews.refinementSearchView,this.restrictionSelectionPage[this.restrictionSelectionPage.length-1]===this.navCurrentView&&this.restrictionSelectionPage.pop())}else b.hasOwnProperty("finalSearchResult")&&(this.finalSearchResults=b.finalSearchResult,
this.estimatedMaxTiv=this.finalSearchResults.maxTiv,this.navCurrentView=this.navViews.tradeInConditionView,b.finalSearchResult.hasOwnProperty("verticalImageUrl")&&(this.searchTradeInImageIndicator=b.finalSearchResult.verticalImageUrl));this.updateCartHeaderData();this.loadingSpinnerHide();this.createView();this.restrictionSelectionPage.push(this.navCurrentView)},this),error:e.proxy(function(a){this.selectionInProgress=!1;this.handleRequestError(a,"Search refinement selection error","Error encountered hitting search refinement request")},
this)})}catch(c){this.selectionInProgress=!1,this.clearAllViews(),this.tradeInWrapper.append(e(".tradein-templates .tradein-general-error").clone()).addClass("active")}},handleContinueConditionButtonClick:function(){if(!this.isProcessing){this.isProcessing=!0;var b=!1===this.isLowestAppraisal?this.conditionSelectionMap.tradeInQuestionResponses.appraisal:"ACCEPT_WORSE";d.recordTv2RefTag(a.APPRAISAL_REF_TAG[b],this.tradeInRefTagUrl,this.bifurcationRefTags);this.loadingSpinnerShow();b={asin:this.finalSearchResults.asin,
condition:this.conditionSelectionMap.gradedCondition,returnOption:b,requestToken:d.getCsrfTokenByKey(a.csrfSaveGradedItemKey,this.config)};l.post(this.tradeInSaveGradedItemConditionUrl,{params:b,success:e.proxy(function(b){d.updateCsrfTokenByKey(a.csrfSaveGradedItemKey,b,this.config);this.loadingSpinnerHide();this.config.pageIndex++;this.conditionSelectionMap.hasBeenGraded=!0;this.doTradeInReviewValidation(e.proxy(function(){this.navCurrentView=this.navViews.submitTradeInView;this.createView();this.restrictionSelectionPage.push(this.navCurrentView);
this.isProcessing=!1},this))},this),error:e.proxy(function(a){this.isProcessing=!1;this.handleRequestError(a,"TradeIn save graded condition error","Error encountered during TradeIn save graded condition request")},this)})}},handleChangeConditionComplete:function(){if(!this.isProcessing){this.isProcessing=!0;this.loadingSpinnerShow();var b={asin:this.changeConditionData.asin,condition:this.conditionSelectionMap.gradedCondition,returnOption:this.conditionSelectionMap.tradeInQuestionResponses.appraisal,
requestToken:d.getCsrfTokenByKey(a.csrfSaveGradedItemKey,this.config)};l.post(this.tradeInSaveGradedItemConditionUrl,{params:b,success:e.proxy(function(b){this.loadingSpinnerHide();this.isProcessing=!1;d.updateCsrfTokenByKey(a.csrfSaveGradedItemKey,b,this.config);this.conditionSelectionMap.hasBeenGraded=!0;this.handleNavigateBackToCartPage(this.restrictionSelectionPage.pop())},this),error:e.proxy(function(a){this.isProcessing=!1;this.handleRequestError(a,"TradeIn save graded condition error","Error encountered during TradeIn save graded condition request")},
this)})}},handleConditionSelection:function(b){try{var c=e(b.currentTarget),f=c.closest(a.conditionQuestionButtonSelectorClass);this.conditionSelectionMap.tradeInQuestionResponses[f.attr("name")]=f.val();this.toggleConditionState(this.conditionSelectionMap,c,f.attr("name"))}catch(g){this.showAlert(a.alertItemAcceptableClass,c.closest(a.conditionQuestionContainerClass)),k(e(f)).setStatus("normal"),k(a.continueConditionButtonViewClass).disable(),d.recordError(g,"Error occurred during handleConditionSelection")}},
toggleConditionState:function(b,c,d){var f=[a.appraisalInputName];e.each(b.tradeInQuestions,function(a,b){b.hasOwnProperty("id")&&f.push(b.id)});var g=!1;e.each(f,e.proxy(function(a,c){"Unacceptable"===b.tradeInQuestionResponses[c]&&(g=!0)},this));var h=c.closest(a.conditionQuestionnaireListClass);g?(this.showAlert(a.alertItemAcceptableClass,c.closest(a.conditionQuestionContainerClass)),h.find(a.conditionQuestionButtonSelectorClass).each(function(){e(this).attr("name")!==d&&(k(e(this)).disable(),
e(this).addClass("a-button-unavailable"))})):(e(c).closest(a.conditionQuestionContainerClass).find(".alert-wrapper").html("").removeClass("active"),h.find(a.conditionQuestionButtonSelectorClass).each(function(){k(e(this)).enable();e(this).hasClass("a-button-unavailable")&&e(this).removeClass("a-button-unavailable")}));h=h.find(a.conditionQuestionContainerClass).length;c=Object.keys(b.tradeInQuestionResponses).length;c>=h&&(this.tradeInWrapper.find(a.appraisalWrapperClass).removeClass("aok-hidden"),
this.updateTradeInValue(b));h=k(a.continueConditionButtonViewClass);!g&&f.length===c||this.isLowestAppraisal&&!g&&f.length-1===c?h.enable():h.disable()},updateTradeInValue:function(b){var c=this.getConditionWeightageMap(b),f=[],g=null;e.each(b.tradeInQuestionResponses,function(b,d){b!==a.appraisalInputName&&f.push(c[d])});var h=l.reduce(f,function(a,b){return b&&b>a?b:a},0);e.each(c,function(a,b){if(b===h)return g=a,!1});b.gradedCondition=g;b.tradeInValue=b.conditionOfferMap[g].tiv;var k=d.getSortedConditionTradeInValues(b),
m=k.indexOf(b.tradeInValue),p=this.tradeInWrapper.find(a.appraisalWrapperClass),q=p.find(".appraisal-container"),p=p.find(".refinement-display-title-wrapper"),r=q.find(".appraisal-buttons-container"),v=this.tradeInWrapper.find(a.continueConditionButtonViewClass);k.length&&-1!==m&&(r.find(".adjusted-pricing").each(function(){e(this).addClass("aok-hidden")}),p.find(".no-appraisal-adjustment").addClass("aok-hidden"),k=k.slice(0,m),this.isLowestAppraisal=!1,0===k.length?(this.isLowestAppraisal=!0,v.removeClass("a-button-disabled"),
v.addClass("a-button-enabled"),q.addClass("aok-hidden"),p.find(".refinement-display-title").addClass("aok-hidden"),p.find(".no-appraisal-adjustment").removeClass("aok-hidden")):1===k.length?(q.removeClass("aok-hidden"),p.find(".refinement-display-title").removeClass("aok-hidden"),r.find(".adjusted-pricing-single").removeClass("aok-hidden")):2===k.length?(q.removeClass("aok-hidden"),p.find(".refinement-display-title").removeClass("aok-hidden"),r.find(".adjusted-pricing-or").removeClass("aok-hidden"),
q=d.formatCurrency(k[k.length-1]),this.tradeInWrapper.find(a.conditionAppraisalMaxTivClass).html(q)):2<k.length&&(q.removeClass("aok-hidden"),p.find(".refinement-display-title").removeClass("aok-hidden"),r.find(".adjusted-pricing-range").removeClass("aok-hidden"),q=d.formatCurrency(k[k.length-1]),this.tradeInWrapper.find(a.conditionAppraisalMaxTivClass).html(q)));b=d.formatCurrency(b.tradeInValue);this.tradeInWrapper.find(a.conditionPageEstimatedTivComponentsSelector).addClass("aok-hidden");this.tradeInWrapper.find(a.conditionPageFinalTivComponentsSelector).removeClass("aok-hidden");
this.tradeInWrapper.find(a.appraisalWrapperClass+" "+a.appraisalTivPriceClass).html(b);this.tradeInWrapper.find(a.conditionPageHeaderTivSelector).html(b)},handleRequestError:function(b,c,f){this.loadingSpinnerHide();b.http.status===a.unauthorizedCode?this.handleLoginPrompt():(d.recordError(c,f),this.clearAllViews(),this.tradeInWrapper.append(e(".tradein-templates .tradein-general-error").clone()).addClass("active"))},handleLoginPrompt:function(){d.recordTv2RefTag(a.refTagAuthRequired,this.tradeInRefTagUrl,
this.bifurcationRefTags);this.clearAllViews();this.tradeInWrapper.append(e("#alertTemplates "+a.alertPromptLoginClass).clone()).addClass("logged-out-message")},getConditionWeightageMap:function(a){var b=[],c={},d;for(d in a.conditionOfferMap)a.conditionOfferMap.hasOwnProperty(d)&&b.push([d,a.conditionOfferMap[d].tiv]);b.sort(function(a,b){return b[1]-a[1]});e.each(b,function(a,b){c[b[0]]=a});return c},setGradedCondition:function(b){var c=this.getConditionWeightageMap(b),f=[],g=null;e.each(b.tradeInQuestionResponses,
function(b,d){b!==a.appraisalInputName&&f.push(c[d])});var h=l.reduce(f,function(a,b){return b&&b>a?b:a},0);e.each(c,function(a,b){if(b===h)return g=a,!1});b.gradedCondition=g;b.tradeInValue=b.conditionOfferMap[g].tiv;this.tradeInWrapper.find("#conditionGrade_"+b.asin+" #estimatedTiv").html(d.formatCurrency(b.tradeInValue))},loadingSpinnerShow:function(){this.loadingSpinner.addClass("active")},loadingSpinnerHide:function(){this.loadingSpinner.removeClass("active")},showAlert:function(a,b){e(b).find(".alert-wrapper").html("").removeClass("active");
e(b.find(".alert-wrapper")).append(e("#alertTemplates "+a).clone()).addClass("active")},updateLaunchButtonText:function(){l.declarative.remove(e("#tradeInLaunchAction"),"launch-tanooki-wireless");l.declarative.remove(e("#tradeInLaunchAction"),"launch-tanooki-v2");var a=e(".tradein-instant-savings-launch-button"),b="#successfulNonIpButtonText";this.tradeInReviewData.instantPaymentEligible&&(b=this.promotionEligible?"#successfulIpWithPromotionButtonText":"#successfulIpNoPromotionButtonText");b=e(".tradein-templates "+
b).clone();e(b).find(".total-tiv").text(d.formatCurrency(this.tradeInReviewData.orderTotalGC));if(this.promotionEligible){var c=b.find(".promotionPercentageDisplayText").get(0);e(c).html(this.tradeInReviewData.promotionEligibilityText[0])}var f=b.get(0);e.each(a,function(){e(this).replaceWith(f)})},doTradeInReviewValidation:function(b){this.hasPendingRequest||(this.loadingSpinnerShow(),this.hasPendingRequest=!0,l.post(this.tradeInReviewUrl,{params:{currentAsin:d.getCurrentAsin(),requestToken:d.getCsrfTokenByKey(a.csrfReviewRequestKey,
this.config)},success:e.proxy(function(c){d.updateCsrfTokenByKey(a.csrfReviewRequestKey,c,this.config);this.tradeInReviewData=c;this.tradeInCartTiv=this.tradeInReviewData.orderTotalGC;this.tradeInCartQuantity=this.getSanitizedItemListFromReviewData().length;this.loadingSpinnerHide();this.hasPendingRequest=!1;b()},this),error:e.proxy(function(a){this.hasPendingRequest=!1;this.handleRequestError(a,"TradeIn review error","Error encountered during TradeIn review request")},this)}))},getSanitizedItemListFromReviewData:function(){var a=
this.tradeInReviewData.hasOwnProperty("sanitizedItemsList"),b=e.isArray(this.tradeInReviewData.sanitizedItemsList);return a&&b?this.tradeInReviewData.sanitizedItemsList:[]},getIsMixedOfferFromSubmitData:function(){return 0<this.tradeInSubmitData.ipItems&&0<this.tradeInSubmitData.nonIpItems},getIsIpOnlyOfferFromSubmitData:function(){return 0<this.tradeInSubmitData.ipItems&&0===this.tradeInSubmitData.nonIpItems},getIsPromotionEligibleFromReviewData:function(){return this.tradeInReviewData.hasOwnProperty("promotionEligible")?
this.tradeInReviewData.promotionEligible:!1},renderTemplateView:function(a,b){for(var c=0;c<a.length;c++)a[c]&&(d.isMobileVariant(this.deviceType)&&e(a[c]).find(".mobile-small-button").each(function(){e(this).addClass("a-button-small")}),this.tradeInWrapper.append(a[c]));b&&"function"===typeof b&&b()},getSearchInput:function(b){var c=b.find(a.refinementSearchInputSelector);return c.is("input")||(c=b.find(a.refinementSearchInputMobileSelector),c.is("input"))?c:void 0},populateUnavailableOffers:function(a){a.find(".unavailable-item").each(function(){var a=
e(this).find(".tiv-estimate-container"),b=a.find(".unavailable-offer");e(b).removeClass("aok-hidden");e(a).html(b)})},updateSearchCounts:function(b){var c=b.find(a.refinementSearchResultSelector).not(".aok-hidden").length;b.find(this.searchOffersOnly?a.refinementSearchOnlyOffersCountId:a.refinementSearchAllOffersCountId).html(c)},overrideRefinementTitleForSearch:function(a){var b=this.config.restrictionHistory;b&&e.isArray(b)&&b[0].hasOwnProperty("emittedData")&&b[1].hasOwnProperty("emittedData")&&
(a.refinementTitle=b[1].emittedData+" "+b[0].emittedData)},hasDefaultReturnAddress:function(){if(!this.tradeInReviewData.hasOwnProperty("defaultReturnAddressId")||!this.tradeInReviewData.defaultReturnAddressId)return this.invalidReturnAddress=!0,e(".tradein-templates .tradein-info-submit-address-error").clone().addClass("active")},recordViewRefTag:function(){d.recordTv2RefTag(this.getCurrentViewForRefTag(),this.tradeInRefTagUrl,this.bifurcationRefTags)},getCurrentViewForRefTag:function(){var b=this.navCurrentView===
this.navViews.refinementSelectionView?this.getCurrentRefinementTitleForRefTag():this.navCurrentView;return a.VIEW_REF_TAG[b]},getCurrentRefinementTitleForRefTag:function(){var a=this.config;return a.selectionDetails&&a.selectionDetails.refinementTitle?a.selectionDetails.refinementTitle.split(" ").join("-"):""},generateBifurcationTag:function(a){this.bifurcationRefTags.push(this.getCurrentViewForRefTag()+"_"+a.substring(0,3))},load_stub_tester:function(b){this.config=l.state("tradeInConfig");d.setLocale(this.config.locale);
d.setCurrencyCode(this.config.currencyCode);f.setCommonUtils(d);this.navViews={refinementSelectionView:a.refinementSelectionViewWrapperClass,tradeInConditionView:a.conditionViewTemplateId,submitTradeInView:a.submitTradeInWrapperClass,restrictionSearchTradeInNextStepView:a.tradeinReviewYourOrderNextStepTemplateId};this.getElements();this.bindEvents();this.cleanState();this.navCurrentView=b;this.createView()}})});"use strict";u.when("A","trade-in-constants","trade-in-data-binder","trade-in-common-utils",
"ready").register("trade-in-common-base",function(l,m,k,a){var h=l.$;return l.createClass({createReturnAddressInstance:function(a){if(this.tradeInReviewData&&0<a.length)if(0===a.children().length){for(var f in this.tradeInReviewData.returnAddresses)if(this.tradeInReviewData.returnAddresses.hasOwnProperty(f)){var l=this.tradeInReviewData.returnAddresses[f];l.formalAddress=k.bindDataToTemplate(h("#addressLineFormalTemplate"),l);var c=k.bindDataToTemplate(h("#addressLineItemTemplate"),l),b=this.tradeInReviewData.defaultReturnAddressId===
l.addressId;c.find('input[type\x3d"radio"]').val(l.addressId).prop("checked",b);c.data("templateModel",l);a.append(c)}a.delegate('input[type\x3d"radio"]',"change",h.proxy(this.handleReturnAddressChange,this))}else a=a.find('input[type\x3d"radio"]'),h.each(a,h.proxy(function(a,b){a=h(b);a.prop("checked",a.val()===this.tradeInReviewData.defaultReturnAddressId)},this))},doTradeInItemRemove:function(d,f){try{this.loadingSpinnerShow(),l.post(this.tradeInRemoveItemUrl,{params:{asin:d,decline:!0,requestToken:a.getCsrfTokenByKey(m.csrfRemoveRequestKey,
this.config)},success:h.proxy(function(d){a.updateCsrfTokenByKey(m.csrfRemoveRequestKey,d,this.config);this.loadingSpinnerHide();f&&"function"===typeof f&&f()},this),error:h.proxy(function(a){this.handleRequestError(a,"TradeIn deselect remove error","Error encountered during TradeIn deselect remove request")},this)})}catch(k){a.recordError(k,"doTradeInItemRemove error")}}})});"use strict";u.register("tradein-show-promotion-expander",function(){return{isEnabled:!1}});"use strict";u.register("ip-preference-buttons",
function(){return{isEnabled:!1}});"use strict";u.register("tanooki-ingress-button-treatment",function(){return{isEnabled:!1}});"use strict";u.register("trade-in-cc-card-wireless-gl-gate",function(){return{isEnabled:!0}});"use strict";u.register("trade-in-cc-card-wireless-gl-gate-mobile",function(){return{isEnabled:!0}});"use strict";u.register("tanooki-offline",function(){return{isEnabled:!0}});"use strict";u.when("trade-in-cc-card-wireless-gl-gate","trade-in-cc-card-wireless-gl-gate-mobile").register("trade-in-cc-constants",
function(l,m){if(l.isEnabled||m.isEnabled)return{featureName:"tradeInInstantSavings",featureAttribution:"Website/CETech/WirelessPlans",actions:{expand:"trade-in-cc-card:expanded",collapse:"trade-in-cc-card:collapse",atfRefresh:"PageRefresh:ATF",ingress:"trade-in-button:ingress"},selectors:{expanderIcon:".trade-in-cc-header-icon",expanderContentWrapper:".trade-in-cc-expander-content-wrapper",expanderContent:".trade-in-cc-expander-content",expanderContentPre:".trade-in-cc-expander-content-pre",expandInitiallyInput:".trade-in-cc-expand-initially-input",
tradeInCCCardTemplate:".trade-in-cc-card-template",successMessage:".trade-in-cc-card-template .trade-in-cc-success-message",tivMessage:".trade-in-cc-tiv-message",promoMessage:".trade-in-cc-promo-message",tradeInMessageTemplate:".trade-in-cc-ti-message-template",ipTradeInMessage:".trade-in-cc-ip-ti-message",mixedTradeInMessage:".trade-in-cc-mixed-ti-message",postGradeTradeInMessage:".trade-in-cc-post-grade-ti-message",subtitleWrapper:".trade-in-cc-subtitle-wrapper",subtitle:".trade-in-cc-subtitle",
submittedMessage:".trade-in-cc-submitted-message",ccCardTotalTiv:".cc-card-total-tiv",ccCardIpTiv:".cc-card-ip-tiv",promoContent:".trade-in-cc-promo-message-template .trade-in-cc-promo-content",promoTitle:".trade-in-cc-promo-title",promoSubtitle:".trade-in-cc-promo-subtitle",ipPromoSubtitle:".trade-in-cc-ip-promo-subtitle",nipPromoSubtitle:".trade-in-cc-non-ip-promo-subtitle",promoTitleSingle:".trade-in-cc-promo-title-single",singlePromoTitle:".single-promo-title",promoTitleMultiple:".trade-in-cc-promo-title-multiple",
lastPromoTitle:".last-promo-title",remainingPromoAmount:".remaining-promo-amount",collapseAfterSubmission:"input[name\x3d'tradeInCCCardCollapseAfterSubmission']"},classes:{hidden:"aok-hidden",rotate:"rotate",tradeInCCExpanded:"trade-in-cc-expander-content-wrapper-expanded",contentHidden:"content-hidden"}}});"use strict";u.when("A","trade-in-cc-constants","trade-in-cc-card-wireless-gl-gate","trade-in-cc-card-wireless-gl-gate-mobile").register("trade-in-cc-expander",function(l,m,k,a){function h(a){d(f.expanderIcon).toggleClass(r.rotate,
a);d(f.subtitleWrapper).toggleClass(r.hidden,a);d(f.expanderContent).toggleClass(r.contentHidden,!a);return d(f.expanderContentWrapper).toggleClass(r.tradeInCCExpanded,a).hasClass(r.tradeInCCExpanded)}if(k.isEnabled||a.isEnabled){var d=l.$,f=m.selectors,r=m.classes;return{toggleCard:h}}});"use strict";u.when("A","cc-manager","trade-in-cc-constants","trade-in-cc-card-wireless-gl-gate","trade-in-cc-card-wireless-gl-gate-mobile").register("trade-in-cc-registration",function(l,m,k,a,h){if(a.isEnabled||
h.isEnabled)a={featureName:k.featureName,featureAttribution:k.featureAttribution},l.on(k.actions.expand,function(){m.cardExpanded(k.featureName)}),m.registerFeature(a,{init:function(){},validateInputParams:function(){return!0},cardCollapse:function(){l.trigger(k.actions.collapse)}})});"use strict";u.when("A","trade-in-cc-constants","trade-in-cc-expander","trade-in-cc-card-wireless-gl-gate","trade-in-cc-card-wireless-gl-gate-mobile","trade-in-cc-registration").execute(function(l,m,k,a,h){function d(){var a=
!r(b.expanderContentWrapper).hasClass(g.tradeInCCExpanded);k.toggleCard(a);a&&l.trigger(c.expand)}function f(){"true"===r(b.expandInitiallyInput).val()&&k.toggleCard(!0)}if(a.isEnabled||h.isEnabled){var r=l.$,c=m.actions,b=m.selectors,g=m.classes;l.declarative("toggle-trade-in-cc-card","click",d);l.on(c.collapse,function(){k.toggleCard(!1)});l.on(c.atfRefresh,function(){f()});f()}});"use strict";u.when("A","trade-in-cc-constants","trade-in-cc-card-wireless-gl-gate","trade-in-cc-card-wireless-gl-gate-mobile",
"trade-in-cc-registration").execute("trade-in-cc-metrics",function(l,m,k,a){if(k.isEnabled||a.isEnabled){var h=m.actions,d=function(){var a=r.ue;return{incrementCount:function(d){a&&a.count&&d&&(d="twisterPlus_tradeIn_"+d+"."+m.featureName,a.count(d,(a.count(d)||0)+1))}}}();l.declarative("launch-tanooki-v2",function(){l.trigger(h.ingress)});l.on(h.expand,function(){d.incrementCount("ccExpanded")});l.on(h.ingress,function(){d.incrementCount("ccIngress")})}})});